<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dalmex Fiber Hub AI</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --ai-purple: #8b5cf6;
            --ai-purple-dark: #7c3aed;
            --dark: #1e293b;
            --darker: #0f172a;
            --card-bg: #ffffff;
            --bg: #f1f5f9;
            --light: #e2e8f0;
            --text: #1e293b;
            --text-muted: #64748b;
            --border-radius: 16px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
        
        /* News Ticker */
        .ticker-wrap { background: linear-gradient(90deg, var(--darker) 0%, var(--dark) 100%); padding: 10px 0; overflow: hidden; }
        .ticker { display: flex; animation: tickerScroll 45s linear infinite; width: max-content; }
        @keyframes tickerScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .ticker-item { display: inline-flex; align-items: center; gap: 8px; margin-right: 50px; color: #f1f5f9; font-size: 13px; white-space: nowrap; }
        .ticker-badge { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .ticker-badge.price { background: var(--warning); color: #000; }
        .ticker-badge.news { background: #3b82f6; }
        .ticker-badge.alert { background: var(--danger); }
        
        /* Header */
        .header { background: var(--card-bg); padding: 12px 20px; border-bottom: 1px solid var(--light); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .header-inner { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .header-left { display: flex; align-items: center; gap: 12px; }
        .logo { width: 45px; height: 45px; background: linear-gradient(135deg, var(--ai-purple) 0%, var(--ai-purple-dark) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
        .brand-title { font-size: 20px; font-weight: 800; background: linear-gradient(135deg, var(--ai-purple), var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .brand-sub { font-size: 11px; color: var(--text-muted); font-weight: 500; }
        .header-right { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .user-badge { background: var(--light); padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; color: var(--primary-dark); }
        .lang-toggle { padding: 8px 14px; background: linear-gradient(135deg, #059669, #10b981); color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .lang-toggle:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .logout-btn { padding: 8px 14px; background: var(--danger); color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .logout-btn:hover { background: #dc2626; }
        
        /* Navigation */
        .nav-bar { background: var(--card-bg); padding: 10px 20px; border-bottom: 1px solid var(--light); overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .nav-inner { max-width: 1400px; margin: 0 auto; display: flex; gap: 8px; }
        .nav-btn { padding: 10px 18px; border: none; background: var(--light); border-radius: 10px; font-size: 13px; font-weight: 600; color: var(--text-muted); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; white-space: nowrap; }
        .nav-btn:hover { background: #e0e7ff; color: var(--primary); }
        .nav-btn.active { background: linear-gradient(135deg, var(--primary) 0%, var(--ai-purple) 100%); color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .nav-btn.ai { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(139, 92, 246, 0); } }
        .nav-count { background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 6px; font-size: 11px; }
        
        /* Main Content */
        .main { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Login Screen */
        .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, var(--ai-purple-dark) 100%); padding: 20px; }
        .login-screen.hidden { display: none; }
        .login-card { background: var(--card-bg); border-radius: 24px; padding: 40px; width: 100%; max-width: 420px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3); }
        .login-logo { width: 80px; height: 80px; background: linear-gradient(135deg, var(--ai-purple) 0%, var(--ai-purple-dark) 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px; box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4); }
        .login-title { text-align: center; font-size: 28px; font-weight: 800; margin-bottom: 8px; }
        .login-subtitle { text-align: center; color: var(--text-muted); margin-bottom: 30px; font-size: 14px; }
        .login-lang-btns { display: flex; gap: 10px; justify-content: center; margin-bottom: 25px; }
        .lang-btn { flex: 1; padding: 12px; border: 2px solid var(--light); background: white; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .lang-btn.active { border-color: var(--primary); background: #e0e7ff; color: var(--primary); }
        .lang-btn:hover { border-color: var(--primary); }
        .login-error { background: #fef2f2; color: var(--danger); padding: 12px; border-radius: 10px; margin-bottom: 15px; font-size: 13px; text-align: center; display: none; }
        .login-error.show { display: block; }
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-muted); }
        .form-input { width: 100%; padding: 14px 16px; border: 2px solid var(--light); border-radius: 12px; font-size: 15px; font-family: inherit; transition: all 0.2s; }
        .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .login-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--primary) 0%, var(--ai-purple) 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s; margin-top: 10px; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4); }
        .quick-access { text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--light); }
        .quick-btn { background: none; border: none; color: var(--primary); font-size: 14px; font-weight: 600; cursor: pointer; text-decoration: underline; }
        .login-footer { text-align: center; margin-top: 25px; font-size: 12px; color: var(--text-muted); line-height: 1.6; }
        
        /* App Container */
        .app { display: none; }
        .app.active { display: block; }
        
        /* AI Chat Panel */
        .ai-container { display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        @media (max-width: 1024px) { .ai-container { grid-template-columns: 1fr; } }
        .chat-panel { background: var(--card-bg); border-radius: var(--border-radius); box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .chat-header { background: linear-gradient(135deg, var(--ai-purple) 0%, var(--ai-purple-dark) 100%); color: white; padding: 20px; display: flex; align-items: center; gap: 15px; }
        .chat-avatar { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .chat-title { font-size: 18px; font-weight: 700; }
        .chat-status { font-size: 12px; opacity: 0.8; margin-top: 2px; }
        .chat-messages { height: 400px; overflow-y: auto; padding: 20px; background: #fafbfc; }
        .msg { display: flex; gap: 12px; margin-bottom: 16px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .msg.user { flex-direction: row-reverse; }
        .msg-avatar { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .msg.ai .msg-avatar { background: linear-gradient(135deg, var(--ai-purple), var(--ai-purple-dark)); }
        .msg.user .msg-avatar { background: var(--primary); }
        .msg-content { max-width: 80%; padding: 14px 18px; border-radius: 16px; font-size: 14px; line-height: 1.6; }
        .msg.ai .msg-content { background: white; border: 1px solid var(--light); border-bottom-left-radius: 4px; }
        .msg.user .msg-content { background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        .chat-input-area { padding: 15px 20px; background: white; border-top: 1px solid var(--light); display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 14px 18px; border: 2px solid var(--light); border-radius: 12px; font-size: 14px; font-family: inherit; }
        .chat-input:focus { outline: none; border-color: var(--ai-purple); }
        
        /* Side Panel */
        .side-panel { display: flex; flex-direction: column; gap: 15px; }
        .panel-card { background: var(--card-bg); border-radius: var(--border-radius); padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .panel-title { font-size: 14px; font-weight: 700; color: var(--text-muted); margin-bottom: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
        .quick-action { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg); border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; border: none; width: 100%; text-align: left; font-family: inherit; }
        .quick-action:hover { background: #e0e7ff; transform: translateX(4px); }
        .quick-action-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .quick-action-text { font-size: 13px; font-weight: 600; color: var(--text); }
        .quick-action-sub { font-size: 11px; color: var(--text-muted); }
        
        /* Best Buyers Card */
        .best-buyer { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 10px; margin-bottom: 8px; }
        .best-buyer-info { display: flex; align-items: center; gap: 10px; }
        .best-buyer-rank { width: 28px; height: 28px; background: linear-gradient(135deg, var(--warning), #fbbf24); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; }
        .best-buyer-name { font-size: 13px; font-weight: 600; }
        .best-buyer-type { font-size: 11px; color: var(--text-muted); }
        .best-buyer-price { font-size: 15px; font-weight: 700; color: var(--success); }
        
        /* Buttons */
        .btn { padding: 12px 20px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: inherit; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-purple { background: linear-gradient(135deg, var(--ai-purple) 0%, var(--ai-purple-dark) 100%); color: white; }
        .btn-purple:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4); }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--light); color: var(--text); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
        .btn-sm { padding: 8px 14px; font-size: 12px; }
        
        /* Contacts Grid */
        .contacts-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; }
        .search-box { display: flex; align-items: center; gap: 10px; background: var(--card-bg); padding: 10px 16px; border-radius: 12px; flex: 1; max-width: 400px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .search-box input { border: none; background: none; flex: 1; font-size: 14px; font-family: inherit; }
        .search-box input:focus { outline: none; }
        .filter-btns { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border: 2px solid var(--light); background: white; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .filter-btn.active { border-color: var(--primary); background: #e0e7ff; color: var(--primary); }
        .contacts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }
        .contact-card { background: var(--card-bg); border-radius: var(--border-radius); padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: all 0.2s; border: 2px solid transparent; }
        .contact-card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
        .contact-card.priority { border-color: var(--warning); }
        .contact-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .contact-name { font-size: 16px; font-weight: 700; }
        .contact-type { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .contact-type.mill { background: #dbeafe; color: #1d4ed8; }
        .contact-type.broker { background: #fef3c7; color: #b45309; }
        .contact-type.export { background: #d1fae5; color: #047857; }
        .contact-person { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
        .contact-commodities { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .commodity-tag { padding: 4px 10px; background: var(--light); border-radius: 6px; font-size: 11px; font-weight: 600; }
        .contact-prices { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px; padding: 12px; background: var(--bg); border-radius: 10px; }
        .price-item { text-align: center; }
        .price-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; }
        .price-value { font-size: 14px; font-weight: 700; color: var(--success); }
        .contact-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .contact-action { padding: 8px 12px; background: var(--bg); border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .contact-action:hover { background: var(--light); }
        .contact-action.edit { color: var(--primary); }
        .contact-action.delete { color: var(--danger); }
        .contact-action.email { color: var(--success); }
        .contact-action.call { color: var(--warning); }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; display: none; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--card-bg); border-radius: 20px; width: 100%; max-width: 550px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--light); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 18px; font-weight: 700; }
        .modal-close { width: 36px; height: 36px; border-radius: 10px; border: none; background: var(--light); cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
        .modal-body { padding: 24px; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--light); display: flex; justify-content: flex-end; gap: 10px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        @media (max-width: 500px) { .form-row { grid-template-columns: 1fr; } }
        .form-select { width: 100%; padding: 12px 16px; border: 2px solid var(--light); border-radius: 10px; font-size: 14px; font-family: inherit; background: white; cursor: pointer; }
        .form-select:focus { outline: none; border-color: var(--primary); }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .checkbox-item { display: flex; align-items: center; gap: 6px; padding: 8px 12px; background: var(--bg); border-radius: 8px; cursor: pointer; }
        .checkbox-item input { width: 16px; height: 16px; cursor: pointer; }
        .checkbox-item label { font-size: 13px; font-weight: 500; cursor: pointer; }
        .switch-group { display: flex; align-items: center; gap: 10px; }
        .switch { width: 48px; height: 26px; background: var(--light); border-radius: 13px; position: relative; cursor: pointer; transition: all 0.2s; }
        .switch.active { background: var(--success); }
        .switch::after { content: ''; position: absolute; width: 22px; height: 22px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .switch.active::after { left: 24px; }
        .form-textarea { width: 100%; padding: 12px 16px; border: 2px solid var(--light); border-radius: 10px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 80px; }
        .form-textarea:focus { outline: none; border-color: var(--primary); }
        
        /* Dashboard Grid */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: var(--card-bg); border-radius: var(--border-radius); padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .stat-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .stat-icon.purple { background: linear-gradient(135deg, var(--ai-purple), var(--ai-purple-dark)); }
        .stat-icon.green { background: linear-gradient(135deg, var(--success), #059669); }
        .stat-icon.yellow { background: linear-gradient(135deg, var(--warning), #d97706); }
        .stat-icon.blue { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        .stat-change { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; }
        .stat-change.up { background: #d1fae5; color: #047857; }
        .stat-change.down { background: #fef2f2; color: #b91c1c; }
        .stat-value { font-size: 32px; font-weight: 800; margin-bottom: 4px; }
        .stat-label { font-size: 13px; color: var(--text-muted); }
        
        /* Prices Section */
        .prices-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .prices-title { font-size: 20px; font-weight: 700; }
        .prices-date { font-size: 13px; color: var(--text-muted); }
        .prices-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
        .price-card { background: var(--card-bg); border-radius: var(--border-radius); padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .price-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .price-commodity { font-size: 14px; font-weight: 700; }
        .price-trend { font-size: 20px; }
        .price-current { font-size: 28px; font-weight: 800; color: var(--success); margin-bottom: 8px; }
        .price-range { font-size: 12px; color: var(--text-muted); }
        .price-source { font-size: 11px; color: var(--text-muted); margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--light); }
        
        /* News Section */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .news-card { background: var(--card-bg); border-radius: var(--border-radius); overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: all 0.2s; }
        .news-card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
        .news-image { height: 160px; background: linear-gradient(135deg, var(--primary), var(--ai-purple)); display: flex; align-items: center; justify-content: center; font-size: 48px; }
        .news-content { padding: 20px; }
        .news-category { display: inline-block; padding: 4px 10px; background: var(--light); border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; margin-bottom: 10px; }
        .news-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; line-height: 1.4; }
        .news-excerpt { font-size: 13px; color: var(--text-muted); line-height: 1.6; margin-bottom: 12px; }
        .news-meta { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--text-muted); }
        
        /* Toast */
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--dark); color: white; padding: 14px 24px; border-radius: 12px; font-size: 14px; font-weight: 500; z-index: 2000; transition: all 0.3s; opacity: 0; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        /* Footer */
        .footer { text-align: center; padding: 30px 20px; color: var(--text-muted); font-size: 12px; border-top: 1px solid var(--light); margin-top: 40px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-inner { flex-direction: column; align-items: stretch; }
            .header-left { justify-content: center; }
            .header-right { justify-content: center; }
            .nav-inner { justify-content: flex-start; }
            .ai-container { grid-template-columns: 1fr; }
            .chat-messages { height: 300px; }
            .contacts-header { flex-direction: column; align-items: stretch; }
            .search-box { max-width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">ü§ñ</div>
            <h1 class="login-title">Dalmex Fiber Hub</h1>
            <p class="login-subtitle" data-en="AI-Powered Recovered Paper Trading" data-es="Comercio de Papel Recuperado con IA">AI-Powered Recovered Paper Trading</p>
            
            <div class="login-lang-btns">
                <button class="lang-btn active" onclick="setLang('en')">üá∫üá∏ English</button>
                <button class="lang-btn" onclick="setLang('es')">üá≤üáΩ Espa√±ol</button>
            </div>
            
            <div class="login-error" id="loginError" data-en="Invalid username or password" data-es="Usuario o contrase√±a inv√°lidos">Invalid username or password</div>
            
            <div class="form-group">
                <label class="form-label" data-en="Username" data-es="Usuario">Username</label>
                <input type="text" class="form-input" id="username" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label class="form-label" data-en="Password" data-es="Contrase√±a">Password</label>
                <input type="password" class="form-input" id="password" placeholder="Enter password">
            </div>
            <button class="login-btn" onclick="handleLogin()" data-en="Sign In" data-es="Iniciar Sesi√≥n">Sign In</button>
            
            <div class="quick-access">
                <button class="quick-btn" onclick="quickAccess()" data-en="Quick Access (No Password)" data-es="Acceso R√°pido (Sin Contrase√±a)">Quick Access (No Password)</button>
            </div>
            
            <div class="login-footer">
                <strong>Dalmex Recycling LLC</strong><br>
                2828 Nagle St. Dallas, TX 75220 ‚Ä¢ 214-352-2000
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div class="app" id="app">
        <!-- News Ticker -->
        <div class="ticker-wrap">
            <div class="ticker" id="ticker"></div>
        </div>
        
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <div class="header-left">
                    <div class="logo">ü§ñ</div>
                    <div>
                        <div class="brand-title">Dalmex Fiber Hub</div>
                        <div class="brand-sub">AI-Powered ‚Ä¢ Dallas, TX</div>
                    </div>
                </div>
                <div class="header-right">
                    <span class="user-badge" id="userBadge">User</span>
                    <button class="lang-toggle" id="langToggle" onclick="toggleLang()">üá≤üáΩ Espa√±ol</button>
                    <button class="logout-btn" onclick="logout()" data-en="Logout" data-es="Salir">Logout</button>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="nav-bar">
            <div class="nav-inner" id="navBar"></div>
        </nav>
        
        <!-- Main Content -->
        <main class="main" id="main"></main>
        
        <!-- Footer -->
        <footer class="footer">
            ¬© 2025 Dalmex Recycling LLC ‚Ä¢ Created by Robert Vandling ‚Ä¢ AI-Powered by Claude
        </footer>
    </div>
    
    <!-- Contact Modal -->
    <div class="modal-overlay" id="contactModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle" data-en="Add Contact" data-es="Agregar Contacto">Add Contact</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="contactForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" data-en="Company Name" data-es="Nombre de Empresa">Company Name</label>
                            <input type="text" class="form-input" id="fCompany" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-en="Contact Person" data-es="Persona de Contacto">Contact Person</label>
                            <input type="text" class="form-input" id="fContact">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" data-en="Email" data-es="Correo">Email</label>
                            <input type="email" class="form-input" id="fEmail">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-en="Phone" data-es="Tel√©fono">Phone</label>
                            <input type="tel" class="form-input" id="fPhone">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" data-en="Type" data-es="Tipo">Type</label>
                            <select class="form-select" id="fType">
                                <option value="mill">Mill / Molino</option>
                                <option value="broker">Broker</option>
                                <option value="export">Export / Exportador</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-en="Priority Contact" data-es="Contacto Prioritario">Priority Contact</label>
                            <div class="switch-group" style="margin-top: 8px;">
                                <div class="switch" id="fPrioritySwitch" onclick="toggleSwitch()"></div>
                                <span data-en="Mark as priority" data-es="Marcar como prioritario">Mark as priority</span>
                                <input type="hidden" id="fPriority">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-en="Commodities" data-es="Materiales">Commodities</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item"><input type="checkbox" name="comm" value="OCC" id="cOCC"><label for="cOCC">OCC</label></div>
                            <div class="checkbox-item"><input type="checkbox" name="comm" value="SWL" id="cSWL"><label for="cSWL">SWL</label></div>
                            <div class="checkbox-item"><input type="checkbox" name="comm" value="PM" id="cPM"><label for="cPM">Mixed Paper</label></div>
                            <div class="checkbox-item"><input type="checkbox" name="comm" value="ONP" id="cONP"><label for="cONP">ONP</label></div>
                            <div class="checkbox-item"><input type="checkbox" name="comm" value="SOP" id="cSOP"><label for="cSOP">SOP</label></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-en="Notes" data-es="Notas">Notes</label>
                        <textarea class="form-textarea" id="fNotes" placeholder="Additional notes..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal()" data-en="Cancel" data-es="Cancelar">Cancel</button>
                <button class="btn btn-primary" onclick="saveContact()" data-en="Save Contact" data-es="Guardar Contacto">Save Contact</button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>

<script>
// ==================== DATA ====================
const users = [
    { username: 'Dalmex', password: '2828', role: 'user', name: 'Dalmex User' },
    { username: 'RJVandling', password: 'Sailer66', role: 'admin', name: 'Robert Vandling' },
    { username: 'guest', password: '', role: 'guest', name: 'Guest User' }
];

const defaultBuyers = [
    { id: 1, company: 'Smurfit Westrock - Forney', contact: 'Mike Johnson', email: 'mjohnson@smurfitwestrock.com', phone: '972-555-1234', type: 'mill', priority: true, commodities: ['OCC', 'SWL'], notes: 'Largest regional buyer', prices: { OCC: 95, SWL: 180 } },
    { id: 2, company: 'Pratt Industries - Conroe', contact: 'Sarah Williams', email: 'swilliams@prattindustries.com', phone: '936-555-2345', type: 'mill', priority: true, commodities: ['OCC', 'PM'], notes: '100% recycled content mill', prices: { OCC: 92, PM: 45 } },
    { id: 3, company: 'Graphic Packaging - Waco', contact: 'David Chen', email: 'dchen@graphicpkg.com', phone: '254-555-3456', type: 'mill', priority: false, commodities: ['SWL', 'SOP'], notes: 'Coated recycled board', prices: { SWL: 175, SOP: 120 } },
    { id: 4, company: 'International Paper', contact: 'Lisa Martinez', email: 'lmartinez@ipaper.com', phone: '903-555-4567', type: 'mill', priority: false, commodities: ['OCC', 'ONP'], notes: 'Multiple facilities', prices: { OCC: 90, ONP: 55 } },
    { id: 5, company: 'Friedman Recycling', contact: 'Tom Friedman', email: 'tom@friedmanrecycling.com', phone: '214-555-5678', type: 'broker', priority: true, commodities: ['OCC', 'SWL', 'PM'], notes: 'Regional broker - good relationships', prices: { OCC: 88, SWL: 165, PM: 40 } },
    { id: 6, company: 'Gulf Coast Paper', contact: 'Carlos Rodriguez', email: 'carlos@gulfcoastpaper.com', phone: '713-555-6789', type: 'broker', priority: false, commodities: ['OCC', 'PM'], notes: 'Export connections', prices: { OCC: 85, PM: 38 } },
    { id: 7, company: 'Asia Pulp Trading', contact: 'Jennifer Wu', email: 'jwu@asiapulp.com', phone: '310-555-7890', type: 'export', priority: false, commodities: ['OCC', 'SWL', 'PM', 'ONP'], notes: 'China/SE Asia markets', prices: { OCC: 82, SWL: 155, PM: 35, ONP: 48 } },
    { id: 8, company: 'Mexico Paper Export', contact: 'Roberto Sanchez', email: 'rsanchez@mexpaper.com', phone: '956-555-8901', type: 'export', priority: false, commodities: ['OCC', 'PM'], notes: 'Mexico mills', prices: { OCC: 80, PM: 32 } }
];

const translations = {
    en: {
        aiAssistant: 'AI Assistant', dashboard: 'Dashboard', contacts: 'Contacts', prices: 'Prices', news: 'News',
        addContact: 'Add Contact', search: 'Search...', all: 'All', mills: 'Mills', brokers: 'Brokers', exports: 'Export',
        bestOCC: 'Best OCC', bestSWL: 'Best SWL', bestPM: 'Best PM', quickActions: 'Quick Actions',
        bestBuyers: 'Top Buyers', whoPaysMost: 'Who pays most for OCC?', bestForSWL: 'Best for SWL?',
        addNew: 'Add new contact', draftEmail: 'Draft email', ppiReport: 'PPI Report', marketOutlook: 'Market outlook',
        priceComparison: 'Buyer Price Comparison', industryNews: 'Industry News', logout: 'Logout',
        totalContacts: 'Total Contacts', priorityContacts: 'Priority', avgOCCPrice: 'Avg OCC Price', pendingFollowups: 'Active Mills'
    },
    es: {
        aiAssistant: 'Asistente IA', dashboard: 'Panel', contacts: 'Contactos', prices: 'Precios', news: 'Noticias',
        addContact: 'Agregar Contacto', search: 'Buscar...', all: 'Todos', mills: 'Molinos', brokers: 'Brokers', exports: 'Exportadores',
        bestOCC: 'Mejor OCC', bestSWL: 'Mejor SWL', bestPM: 'Mejor PM', quickActions: 'Acciones R√°pidas',
        bestBuyers: 'Mejores Compradores', whoPaysMost: '¬øQui√©n paga m√°s por OCC?', bestForSWL: '¬øMejor para SWL?',
        addNew: 'Agregar contacto', draftEmail: 'Redactar email', ppiReport: 'Reporte PPI', marketOutlook: 'Perspectiva mercado',
        priceComparison: 'Comparaci√≥n de Precios', industryNews: 'Noticias de la Industria', logout: 'Salir',
        totalContacts: 'Total Contactos', priorityContacts: 'Prioritarios', avgOCCPrice: 'Precio OCC Prom.', pendingFollowups: 'Molinos Activos'
    }
};

const newsItems = [
    { icon: 'üì∞', category: 'Market', title: 'OCC Prices Stabilize in Q4', excerpt: 'Recovered paper markets show signs of stability as demand from domestic mills remains steady heading into 2025.', date: 'Dec 28, 2024', source: 'Recycling Today' },
    { icon: 'üè≠', category: 'Industry', title: 'Smurfit Westrock Expands Texas Operations', excerpt: 'Major investment in Forney facility to increase recycled fiber capacity by 15% in 2025.', date: 'Dec 26, 2024', source: 'Paper360' },
    { icon: 'üìä', category: 'PPI', title: 'December PPI Report Released', excerpt: 'Latest Producer Price Index shows mixed results across recovered paper grades. OCC up slightly while mixed paper holds steady.', date: 'Dec 20, 2024', source: 'BLS' },
    { icon: 'üåç', category: 'Export', title: 'Southeast Asian Markets Open Up', excerpt: 'New import policies in Vietnam and Indonesia creating opportunities for US recovered paper exports.', date: 'Dec 18, 2024', source: 'Resource Recycling' },
    { icon: '‚ôªÔ∏è', category: 'Sustainability', title: 'EPR Legislation Gains Momentum', excerpt: 'Extended Producer Responsibility laws being considered in multiple states could reshape recycling economics.', date: 'Dec 15, 2024', source: 'Waste Dive' },
    { icon: 'üí∞', category: 'Prices', title: 'White Ledger Premium Holds Strong', excerpt: 'SWL continues to command premium pricing as high-quality fiber demand remains robust.', date: 'Dec 12, 2024', source: 'RISI' }
];

const tickerItems = [
    { type: 'price', text: 'OCC: $95/ton (+$3)' },
    { type: 'price', text: 'SWL: $175/ton (-$5)' },
    { type: 'price', text: 'Mixed Paper: $42/ton (Flat)' },
    { type: 'news', text: 'Smurfit Westrock announces capacity expansion' },
    { type: 'alert', text: 'PPI Report due January 14, 2025' },
    { type: 'news', text: 'China import restrictions continue into 2025' },
    { type: 'price', text: 'ONP: $52/ton (+$2)' },
    { type: 'news', text: 'Pratt Industries reports record recycled content usage' }
];

const ppiPrices = [
    { commodity: 'OCC (PS 11)', price: '$95', range: '$90 - $100', trend: 'üìà', change: '+3.2%', source: 'BLS PPI December 2024' },
    { commodity: 'Sorted White Ledger', price: '$175', range: '$165 - $185', trend: 'üìâ', change: '-2.8%', source: 'BLS PPI December 2024' },
    { commodity: 'Mixed Paper (PS 54)', price: '$42', range: '$38 - $48', trend: '‚û°Ô∏è', change: '0.0%', source: 'BLS PPI December 2024' },
    { commodity: 'ONP (PS 8)', price: '$52', range: '$48 - $58', trend: 'üìà', change: '+4.0%', source: 'BLS PPI December 2024' },
    { commodity: 'Sorted Office Paper', price: '$115', range: '$105 - $125', trend: 'üìà', change: '+1.8%', source: 'BLS PPI December 2024' },
    { commodity: 'DLK (PS 47)', price: '$135', range: '$125 - $145', trend: '‚û°Ô∏è', change: '-0.5%', source: 'BLS PPI December 2024' }
];

// ==================== STATE ====================
let lang = 'en';
let currentUser = null;
let currentTab = 'ai';
let buyers = [];
let chat = [];
let searchTerm = '';
let filterType = 'all';
let editId = null;

// ==================== HELPERS ====================
function t(key) { return translations[lang][key] || key; }

function setLang(l) {
    lang = l;
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.lang-btn').forEach(b => {
        if ((l === 'en' && b.textContent.includes('English')) || (l === 'es' && b.textContent.includes('Espa√±ol'))) {
            b.classList.add('active');
        }
    });
    document.querySelectorAll('[data-' + l + ']').forEach(el => el.textContent = el.getAttribute('data-' + l));
    const toggle = document.getElementById('langToggle');
    if (toggle) toggle.innerHTML = l === 'en' ? 'üá≤üáΩ Espa√±ol' : 'üá∫üá∏ English';
    if (currentUser) { renderNav(); render(); }
}

function toggleLang() {
    setLang(lang === 'en' ? 'es' : 'en');
}

function loadData() {
    const s = localStorage.getItem('fiberhub_buyers');
    buyers = s ? JSON.parse(s) : [...defaultBuyers];
}

function saveData() { localStorage.setItem('fiberhub_buyers', JSON.stringify(buyers)); }

function toast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}

// ==================== AUTH ====================
function handleLogin() {
    const u = document.getElementById('username').value;
    const p = document.getElementById('password').value;
    const user = users.find(x => x.username === u && x.password === p);
    if (user) {
        loginUser(user);
    } else {
        document.getElementById('loginError').classList.add('show');
        setTimeout(() => document.getElementById('loginError').classList.remove('show'), 3000);
    }
}

function quickAccess() {
    loginUser({ username: 'guest', role: 'guest', name: 'Guest User' });
}

function loginUser(user) {
    currentUser = user;
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('app').classList.add('active');
    document.getElementById('userBadge').textContent = user.role === 'admin' ? 'üëë Admin' : user.name;
    loadData();
    initTicker();
    renderNav();
    render();
    addWelcomeMessage();
}

function logout() {
    currentUser = null;
    chat = [];
    document.getElementById('app').classList.remove('active');
    document.getElementById('loginScreen').classList.remove('hidden');
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
}

// ==================== TICKER ====================
function initTicker() {
    const ticker = document.getElementById('ticker');
    const items = tickerItems.map(item => 
        `<div class="ticker-item"><span class="ticker-badge ${item.type}">${item.type.toUpperCase()}</span> ${item.text}</div>`
    ).join('');
    ticker.innerHTML = items + items; // Duplicate for seamless loop
}

// ==================== NAVIGATION ====================
function renderNav() {
    const tabs = [
        { id: 'ai', icon: 'ü§ñ', label: t('aiAssistant'), ai: true },
        { id: 'dashboard', icon: 'üìä', label: t('dashboard') },
        { id: 'contacts', icon: 'üë•', label: t('contacts'), count: buyers.length },
        { id: 'prices', icon: 'üí∞', label: t('prices') },
        { id: 'news', icon: 'üì∞', label: t('news') }
    ];
    document.getElementById('navBar').innerHTML = tabs.map(tab => 
        `<button class="nav-btn ${currentTab === tab.id ? 'active' : ''} ${tab.ai && currentTab !== tab.id ? 'ai' : ''}" onclick="setTab('${tab.id}')">
            ${tab.icon} ${tab.label}${tab.count !== undefined ? ` <span class="nav-count">${tab.count}</span>` : ''}
        </button>`
    ).join('');
}

function setTab(tab) { currentTab = tab; renderNav(); render(); }

// ==================== RENDER ====================
function render() {
    const main = document.getElementById('main');
    switch (currentTab) {
        case 'ai': main.innerHTML = renderAI(); break;
        case 'dashboard': main.innerHTML = renderDashboard(); break;
        case 'contacts': main.innerHTML = renderContacts(); break;
        case 'prices': main.innerHTML = renderPrices(); break;
        case 'news': main.innerHTML = renderNews(); break;
    }
}

function renderAI() {
    const bestOCC = buyers.filter(b => b.prices?.OCC).sort((a, b) => b.prices.OCC - a.prices.OCC).slice(0, 3);
    const bestSWL = buyers.filter(b => b.prices?.SWL).sort((a, b) => b.prices.SWL - a.prices.SWL).slice(0, 3);
    
    return `<div class="ai-container">
        <div class="chat-panel">
            <div class="chat-header">
                <div class="chat-avatar">ü§ñ</div>
                <div>
                    <div class="chat-title">Fiber Hub AI</div>
                    <div class="chat-status">Powered by Claude</div>
                </div>
            </div>
            <div class="chat-messages" id="chatBox">
                ${chat.map(m => `<div class="msg ${m.role}"><div class="msg-avatar">${m.role === 'ai' ? 'ü§ñ' : 'üë§'}</div><div class="msg-content">${m.content}</div></div>`).join('')}
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="${lang === 'es' ? 'Pregunta sobre precios, compradores, emails...' : 'Ask about prices, buyers, emails...'}" onkeypress="if(event.key==='Enter')sendChat()">
                <button class="btn btn-purple" onclick="sendChat()">${lang === 'es' ? 'Enviar' : 'Send'}</button>
            </div>
        </div>
        <div class="side-panel">
            <div class="panel-card">
                <div class="panel-title">${t('quickActions')}</div>
                <button class="quick-action" onclick="askAI('${lang === 'es' ? '¬øQui√©n paga m√°s por OCC?' : 'Who pays most for OCC?'}')">
                    <div class="quick-action-icon" style="background: #fef3c7;">üì¶</div>
                    <div><div class="quick-action-text">${t('bestOCC')}</div><div class="quick-action-sub">${lang === 'es' ? '¬øQui√©n paga m√°s?' : 'Who pays most?'}</div></div>
                </button>
                <button class="quick-action" onclick="askAI('${lang === 'es' ? '¬øMejor precio para SWL?' : 'Best price for SWL?'}')">
                    <div class="quick-action-icon" style="background: #dbeafe;">üìÑ</div>
                    <div><div class="quick-action-text">${t('bestSWL')}</div><div class="quick-action-sub">${lang === 'es' ? 'Papel blanco' : 'White ledger'}</div></div>
                </button>
                <button class="quick-action" onclick="askAI('${lang === 'es' ? 'Mu√©strame el reporte PPI' : 'Show me the PPI report'}')">
                    <div class="quick-action-icon" style="background: #d1fae5;">üìä</div>
                    <div><div class="quick-action-text">${t('ppiReport')}</div><div class="quick-action-sub">${lang === 'es' ? 'Precios actuales' : 'Current prices'}</div></div>
                </button>
                <button class="quick-action" onclick="openModal()">
                    <div class="quick-action-icon" style="background: #e0e7ff;">‚ûï</div>
                    <div><div class="quick-action-text">${t('addNew')}</div><div class="quick-action-sub">${lang === 'es' ? 'Agregar comprador' : 'Add new buyer'}</div></div>
                </button>
            </div>
            <div class="panel-card">
                <div class="panel-title">${t('bestBuyers')} - OCC</div>
                ${bestOCC.map((b, i) => `<div class="best-buyer">
                    <div class="best-buyer-info">
                        <div class="best-buyer-rank">${i + 1}</div>
                        <div><div class="best-buyer-name">${b.company.split(' - ')[0]}</div><div class="best-buyer-type">${b.type}</div></div>
                    </div>
                    <div class="best-buyer-price">$${b.prices.OCC}/ton</div>
                </div>`).join('')}
            </div>
        </div>
    </div>`;
}

function renderDashboard() {
    const mills = buyers.filter(b => b.type === 'mill').length;
    const priority = buyers.filter(b => b.priority).length;
    const avgOCC = Math.round(buyers.filter(b => b.prices?.OCC).reduce((a, b) => a + b.prices.OCC, 0) / buyers.filter(b => b.prices?.OCC).length);
    
    return `<div class="dashboard-grid">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon purple">üë•</div>
                <div class="stat-change up">+2 this month</div>
            </div>
            <div class="stat-value">${buyers.length}</div>
            <div class="stat-label">${t('totalContacts')}</div>
        </div>
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon yellow">‚≠ê</div>
                <div class="stat-change up">Active</div>
            </div>
            <div class="stat-value">${priority}</div>
            <div class="stat-label">${t('priorityContacts')}</div>
        </div>
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon green">üí∞</div>
                <div class="stat-change up">+$3</div>
            </div>
            <div class="stat-value">$${avgOCC}</div>
            <div class="stat-label">${t('avgOCCPrice')}</div>
        </div>
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon blue">üè≠</div>
            </div>
            <div class="stat-value">${mills}</div>
            <div class="stat-label">${t('pendingFollowups')}</div>
        </div>
    </div>
    <div class="panel-card">
        <div class="panel-title">${t('priceComparison')}</div>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="background: var(--bg);">
                        <th style="padding: 12px; text-align: left; font-weight: 600;">${lang === 'es' ? 'Comprador' : 'Buyer'}</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600;">${lang === 'es' ? 'Tipo' : 'Type'}</th>
                        <th style="padding: 12px; text-align: right; font-weight: 600;">OCC</th>
                        <th style="padding: 12px; text-align: right; font-weight: 600;">SWL</th>
                        <th style="padding: 12px; text-align: right; font-weight: 600;">PM</th>
                    </tr>
                </thead>
                <tbody>
                    ${buyers.sort((a, b) => (b.prices?.OCC || 0) - (a.prices?.OCC || 0)).map(b => `
                        <tr style="border-bottom: 1px solid var(--light);">
                            <td style="padding: 12px;">${b.company}</td>
                            <td style="padding: 12px;"><span class="contact-type ${b.type}">${b.type}</span></td>
                            <td style="padding: 12px; text-align: right; font-weight: 600; color: ${b.prices?.OCC ? 'var(--success)' : 'var(--text-muted)'};">${b.prices?.OCC ? '$' + b.prices.OCC : '-'}</td>
                            <td style="padding: 12px; text-align: right; font-weight: 600; color: ${b.prices?.SWL ? 'var(--success)' : 'var(--text-muted)'};">${b.prices?.SWL ? '$' + b.prices.SWL : '-'}</td>
                            <td style="padding: 12px; text-align: right; font-weight: 600; color: ${b.prices?.PM ? 'var(--success)' : 'var(--text-muted)'};">${b.prices?.PM ? '$' + b.prices.PM : '-'}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    </div>`;
}

function renderContacts() {
    let filtered = [...buyers];
    if (searchTerm) {
        const s = searchTerm.toLowerCase();
        filtered = filtered.filter(b => b.company.toLowerCase().includes(s) || b.contact?.toLowerCase().includes(s));
    }
    if (filterType !== 'all') {
        filtered = filtered.filter(b => b.type === filterType);
    }
    
    return `<div class="contacts-header">
        <div class="search-box">
            <span>üîç</span>
            <input type="text" placeholder="${t('search')}" value="${searchTerm}" oninput="searchTerm=this.value;render()">
        </div>
        <div class="filter-btns">
            <button class="filter-btn ${filterType === 'all' ? 'active' : ''}" onclick="filterType='all';render()">${t('all')}</button>
            <button class="filter-btn ${filterType === 'mill' ? 'active' : ''}" onclick="filterType='mill';render()">${t('mills')}</button>
            <button class="filter-btn ${filterType === 'broker' ? 'active' : ''}" onclick="filterType='broker';render()">${t('brokers')}</button>
            <button class="filter-btn ${filterType === 'export' ? 'active' : ''}" onclick="filterType='export';render()">${t('exports')}</button>
        </div>
        <button class="btn btn-primary" onclick="openModal()">‚ûï ${t('addContact')}</button>
    </div>
    <div class="contacts-grid">
        ${filtered.map(b => `<div class="contact-card ${b.priority ? 'priority' : ''}">
            <div class="contact-header">
                <div>
                    <div class="contact-name">${b.company}</div>
                    ${b.priority ? '<span style="color: var(--warning); font-size: 12px;">‚≠ê Priority</span>' : ''}
                </div>
                <span class="contact-type ${b.type}">${b.type}</span>
            </div>
            <div class="contact-person">üë§ ${b.contact || 'No contact'}</div>
            <div class="contact-commodities">
                ${(b.commodities || []).map(c => `<span class="commodity-tag">${c}</span>`).join('')}
            </div>
            ${Object.keys(b.prices || {}).length ? `<div class="contact-prices">
                ${Object.entries(b.prices).map(([k, v]) => `<div class="price-item"><div class="price-label">${k}</div><div class="price-value">$${v}</div></div>`).join('')}
            </div>` : ''}
            <div class="contact-actions">
                ${b.email ? `<button class="contact-action email" onclick="window.location.href='mailto:${b.email}'">‚úâÔ∏è Email</button>` : ''}
                ${b.phone ? `<button class="contact-action call" onclick="window.location.href='tel:${b.phone}'">üìû Call</button>` : ''}
                <button class="contact-action edit" onclick="editContact(${b.id})">‚úèÔ∏è Edit</button>
                <button class="contact-action delete" onclick="deleteContact(${b.id})">üóëÔ∏è Delete</button>
            </div>
        </div>`).join('')}
    </div>`;
}

function renderPrices() {
    return `<div class="prices-header">
        <div>
            <div class="prices-title">${t('ppiReport')}</div>
            <div class="prices-date">${lang === 'es' ? '√öltima actualizaci√≥n: Diciembre 2024' : 'Last updated: December 2024'}</div>
        </div>
        <a href="https://www.bls.gov/ppi/" target="_blank" class="btn btn-outline">üîó ${lang === 'es' ? 'Ver BLS PPI' : 'View BLS PPI'}</a>
    </div>
    <div class="prices-grid">
        ${ppiPrices.map(p => `<div class="price-card">
            <div class="price-card-header">
                <div class="price-commodity">${p.commodity}</div>
                <div class="price-trend">${p.trend}</div>
            </div>
            <div class="price-current">${p.price}/ton</div>
            <div class="price-range">${lang === 'es' ? 'Rango' : 'Range'}: ${p.range}</div>
            <div style="color: ${p.change.startsWith('+') ? 'var(--success)' : p.change.startsWith('-') ? 'var(--danger)' : 'var(--text-muted)'}; font-weight: 600; font-size: 13px; margin-top: 8px;">${p.change} ${lang === 'es' ? 'vs mes anterior' : 'vs last month'}</div>
            <div class="price-source">üìä ${p.source}</div>
        </div>`).join('')}
    </div>`;
}

function renderNews() {
    return `<div style="margin-bottom: 20px;">
        <h2 style="font-size: 20px; font-weight: 700;">${t('industryNews')}</h2>
        <p style="color: var(--text-muted); font-size: 13px;">${lang === 'es' ? '√öltimas noticias del mercado de papel recuperado' : 'Latest recovered paper market news'}</p>
    </div>
    <div class="news-grid">
        ${newsItems.map(n => `<div class="news-card">
            <div class="news-image">${n.icon}</div>
            <div class="news-content">
                <span class="news-category">${n.category}</span>
                <h3 class="news-title">${n.title}</h3>
                <p class="news-excerpt">${n.excerpt}</p>
                <div class="news-meta">
                    <span>${n.date}</span>
                    <span>${n.source}</span>
                </div>
            </div>
        </div>`).join('')}
    </div>`;
}

// ==================== AI CHAT ====================
function addWelcomeMessage() {
    const welcome = lang === 'es' 
        ? `¬°Hola! Soy tu asistente de Fiber Hub. Puedo ayudarte con:\n\n‚Ä¢ "¬øQui√©n paga m√°s por OCC?" - Encontrar mejores precios\n‚Ä¢ "Agregar nuevo comprador" - Abrir formulario de contacto\n‚Ä¢ "Reporte PPI" - Ver precios actuales\n‚Ä¢ "Redactar email para [empresa]" - Crear plantilla de email\n\n¬øEn qu√© puedo ayudarte hoy?`
        : `Hello! I'm your Fiber Hub assistant. I can help you with:\n\n‚Ä¢ "Who pays most for OCC?" - Find best prices\n‚Ä¢ "Add new buyer" - Open contact form\n‚Ä¢ "PPI Report" - View current prices\n‚Ä¢ "Draft email to [company]" - Create email template\n\nHow can I help you today?`;
    chat.push({ role: 'ai', content: welcome });
}

function sendChat() {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    if (!msg) return;
    
    chat.push({ role: 'user', content: msg });
    input.value = '';
    
    // Process and respond
    setTimeout(() => {
        const response = processAIQuery(msg);
        chat.push({ role: 'ai', content: response });
        render();
        document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
    }, 500);
    
    render();
}

function askAI(question) {
    document.getElementById('chatInput').value = question;
    sendChat();
}

function processAIQuery(query) {
    const q = query.toLowerCase();
    
    // Best OCC price
    if (q.includes('occ') && (q.includes('best') || q.includes('most') || q.includes('mejor') || q.includes('m√°s') || q.includes('who pays'))) {
        const best = buyers.filter(b => b.prices?.OCC).sort((a, b) => b.prices.OCC - a.prices.OCC).slice(0, 3);
        return lang === 'es' 
            ? `Los mejores precios de OCC actualmente:\n\n${best.map((b, i) => `${i + 1}. **${b.company}** - $${b.prices.OCC}/ton`).join('\n')}\n\n¬øQuieres que redacte un email para alguno?`
            : `Top OCC prices right now:\n\n${best.map((b, i) => `${i + 1}. **${b.company}** - $${b.prices.OCC}/ton`).join('\n')}\n\nWould you like me to draft an email to any of them?`;
    }
    
    // Best SWL price
    if (q.includes('swl') || q.includes('white') || q.includes('ledger') || q.includes('blanco')) {
        const best = buyers.filter(b => b.prices?.SWL).sort((a, b) => b.prices.SWL - a.prices.SWL).slice(0, 3);
        return lang === 'es' 
            ? `Los mejores precios de SWL (Papel Blanco):\n\n${best.map((b, i) => `${i + 1}. **${b.company}** - $${b.prices.SWL}/ton`).join('\n')}`
            : `Top SWL (Sorted White Ledger) prices:\n\n${best.map((b, i) => `${i + 1}. **${b.company}** - $${b.prices.SWL}/ton`).join('\n')}`;
    }
    
    // PPI Report
    if (q.includes('ppi') || q.includes('report') || q.includes('reporte') || q.includes('prices') || q.includes('precios')) {
        return lang === 'es' 
            ? `üìä **Reporte PPI - Diciembre 2024**\n\n‚Ä¢ OCC: $95/ton (+3.2%)\n‚Ä¢ SWL: $175/ton (-2.8%)\n‚Ä¢ Mixed Paper: $42/ton (sin cambio)\n‚Ä¢ ONP: $52/ton (+4.0%)\n\nPr√≥xima publicaci√≥n: 14 de enero 2025`
            : `üìä **PPI Report - December 2024**\n\n‚Ä¢ OCC: $95/ton (+3.2%)\n‚Ä¢ SWL: $175/ton (-2.8%)\n‚Ä¢ Mixed Paper: $42/ton (unchanged)\n‚Ä¢ ONP: $52/ton (+4.0%)\n\nNext release: January 14, 2025`;
    }
    
    // Add contact
    if (q.includes('add') || q.includes('new') || q.includes('agregar') || q.includes('nuevo')) {
        setTimeout(() => openModal(), 100);
        return lang === 'es' ? 'Abriendo el formulario para agregar un nuevo contacto...' : 'Opening the form to add a new contact...';
    }
    
    // Draft email
    if (q.includes('email') || q.includes('draft') || q.includes('redactar') || q.includes('correo')) {
        return lang === 'es' 
            ? `üìß **Plantilla de Email**\n\nAsunto: Solicitud de Cotizaci√≥n - Dalmex Recycling\n\nEstimado [Contacto],\n\nEspero que este mensaje le encuentre bien. Me comunico de parte de Dalmex Recycling LLC para solicitar sus precios actuales para los siguientes materiales:\n\n‚Ä¢ OCC (PS 11)\n‚Ä¢ SWL\n‚Ä¢ Mixed Paper\n\nNuestro volumen mensual aproximado es de [X] toneladas. Agradecer√≠a mucho si pudiera enviarme su lista de precios actualizada.\n\nSaludos cordiales,\n[Tu nombre]\nDalmex Recycling LLC\n214-352-2000`
            : `üìß **Email Template**\n\nSubject: Price Inquiry - Dalmex Recycling\n\nDear [Contact],\n\nI hope this message finds you well. I'm reaching out from Dalmex Recycling LLC to request your current pricing for the following materials:\n\n‚Ä¢ OCC (PS 11)\n‚Ä¢ SWL\n‚Ä¢ Mixed Paper\n\nOur approximate monthly volume is [X] tons. I would appreciate if you could send me your updated price list.\n\nBest regards,\n[Your name]\nDalmex Recycling LLC\n214-352-2000`;
    }
    
    // Market outlook
    if (q.includes('outlook') || q.includes('forecast') || q.includes('perspectiva') || q.includes('pron√≥stico') || q.includes('market')) {
        return lang === 'es' 
            ? `üìà **Perspectiva del Mercado Q1 2025**\n\n‚Ä¢ **OCC**: Se espera estabilidad con ligero aumento. Demanda dom√©stica fuerte.\n‚Ä¢ **SWL**: Precios premium se mantienen. Oferta limitada.\n‚Ä¢ **Mixed Paper**: Mercado plano, posible presi√≥n a la baja.\n\n**Factores clave:**\n- Restricciones de importaci√≥n en China contin√∫an\n- Expansi√≥n de capacidad de Smurfit Westrock\n- Mercados de exportaci√≥n del sudeste asi√°tico abriendo`
            : `üìà **Market Outlook Q1 2025**\n\n‚Ä¢ **OCC**: Expected to remain stable with slight uptick. Strong domestic demand.\n‚Ä¢ **SWL**: Premium pricing holds. Limited supply.\n‚Ä¢ **Mixed Paper**: Flat market, possible downward pressure.\n\n**Key factors:**\n- China import restrictions continue\n- Smurfit Westrock capacity expansion\n- SE Asian export markets opening`;
    }
    
    // Default response
    return lang === 'es' 
        ? `Puedo ayudarte con:\n\n‚Ä¢ Encontrar mejores precios ("¬øQui√©n paga m√°s por OCC?")\n‚Ä¢ Ver reportes PPI ("Mu√©strame precios")\n‚Ä¢ Agregar contactos ("Agregar nuevo comprador")\n‚Ä¢ Redactar emails ("Redactar email")\n‚Ä¢ Perspectiva del mercado ("¬øC√≥mo est√° el mercado?")\n\n¬øQu√© necesitas?`
        : `I can help you with:\n\n‚Ä¢ Finding best prices ("Who pays most for OCC?")\n‚Ä¢ Viewing PPI reports ("Show me prices")\n‚Ä¢ Adding contacts ("Add new buyer")\n‚Ä¢ Drafting emails ("Draft email")\n‚Ä¢ Market outlook ("How's the market?")\n\nWhat do you need?`;
}

// ==================== CONTACT MODAL ====================
function openModal(id = null) {
    editId = id;
    const modal = document.getElementById('contactModal');
    const title = document.getElementById('modalTitle');
    
    if (id) {
        const b = buyers.find(x => x.id === id);
        if (b) {
            title.textContent = lang === 'es' ? 'Editar Contacto' : 'Edit Contact';
            document.getElementById('fCompany').value = b.company || '';
            document.getElementById('fContact').value = b.contact || '';
            document.getElementById('fEmail').value = b.email || '';
            document.getElementById('fPhone').value = b.phone || '';
            document.getElementById('fType').value = b.type || 'mill';
            document.getElementById('fNotes').value = b.notes || '';
            const sw = document.getElementById('fPrioritySwitch');
            if (b.priority) sw.classList.add('active'); else sw.classList.remove('active');
            document.querySelectorAll('input[name="comm"]').forEach(cb => {
                cb.checked = (b.commodities || []).includes(cb.value);
            });
        }
    } else {
        title.textContent = lang === 'es' ? 'Agregar Contacto' : 'Add Contact';
        document.getElementById('contactForm').reset();
        document.getElementById('fPrioritySwitch').classList.remove('active');
    }
    
    modal.classList.add('active');
}

function closeModal() {
    document.getElementById('contactModal').classList.remove('active');
    editId = null;
}

function toggleSwitch() {
    document.getElementById('fPrioritySwitch').classList.toggle('active');
}

function saveContact() {
    const comms = [];
    document.querySelectorAll('input[name="comm"]:checked').forEach(cb => comms.push(cb.value));
    
    const data = {
        company: document.getElementById('fCompany').value,
        contact: document.getElementById('fContact').value,
        email: document.getElementById('fEmail').value,
        phone: document.getElementById('fPhone').value,
        type: document.getElementById('fType').value,
        priority: document.getElementById('fPrioritySwitch').classList.contains('active'),
        commodities: comms,
        notes: document.getElementById('fNotes').value,
        prices: {}
    };
    
    if (!data.company) {
        toast(lang === 'es' ? 'Nombre de empresa requerido' : 'Company name required');
        return;
    }
    
    if (editId) {
        const idx = buyers.findIndex(b => b.id === editId);
        if (idx !== -1) {
            buyers[idx] = { ...buyers[idx], ...data };
        }
        toast(lang === 'es' ? 'Contacto actualizado' : 'Contact updated');
    } else {
        data.id = buyers.length ? Math.max(...buyers.map(b => b.id)) + 1 : 1;
        buyers.push(data);
        toast(lang === 'es' ? 'Contacto agregado' : 'Contact added');
    }
    
    saveData();
    closeModal();
    renderNav();
    render();
}

function editContact(id) {
    openModal(id);
}

function deleteContact(id) {
    if (confirm(lang === 'es' ? '¬øEliminar este contacto?' : 'Delete this contact?')) {
        buyers = buyers.filter(b => b.id !== id);
        saveData();
        renderNav();
        render();
        toast(lang === 'es' ? 'Contacto eliminado' : 'Contact deleted');
    }
}

// ==================== INIT ====================
document.addEventListener('keypress', e => {
    if (e.key === 'Enter' && !currentUser) handleLogin();
});
</script>
</body>
</html>
