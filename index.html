<!DOCTYPE html>
<html lang="en">
<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  DiversionScan‚Ñ¢ Enterprise Pro                                                ‚ïë
‚ïë  ¬© 2025 Dalmex Recycling, LLC. All Rights Reserved.                          ‚ïë
‚ïë  UNAUTHORIZED COPYING, DISTRIBUTION, OR MODIFICATION IS STRICTLY PROHIBITED  ‚ïë
‚ïë  Protected under US Copyright Law Title 17                                    ‚ïë
‚ïë  Patent Pending                                                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="copyright" content="¬© 2025 Dalmex Recycling, LLC. All Rights Reserved.">
<meta name="author" content="Dalmex Recycling, LLC">
<meta name="robots" content="noindex,nofollow">
<title>DiversionScan‚Ñ¢ | LEED Waste Tracking</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--_0:#0a0f1a;--_1:#111827;--_2:#1a2234;--_3:#0d1421;--_4:#10b981;--_5:#059669;--_6:#3b82f6;--_7:#8b5cf6;--_8:#f59e0b;--_9:#ef4444;--_a:#06b6d4;--_b:#eab308;--_c:#6366f1;--_d:#f1f5f9;--_e:#94a3b8;--_f:#64748b;--_g:#2d3a4f;--_h:env(safe-area-inset-top,20px);--_i:env(safe-area-inset-bottom,20px)}
[data-t="1"]{--_0:#0c1929;--_1:#132337;--_2:#1a3a5c;--_3:#0a1628;--_4:#00d4aa;--_6:#00b4d8;--_g:#234567}
[data-t="2"]{--_0:#1a0a0a;--_1:#2d1515;--_2:#3d1f1f;--_3:#150808;--_4:#ff6b6b;--_8:#ffa500;--_6:#ff8c42;--_g:#4a2525}
[data-t="3"]{--_0:#0a1a0a;--_1:#152815;--_2:#1f3d1f;--_3:#081408;--_4:#4ade80;--_6:#86efac;--_g:#2d4a2d}
[data-t="4"]{--_0:#0f0f1a;--_1:#1a1a2e;--_2:#252547;--_3:#0a0a14;--_4:#a78bfa;--_6:#818cf8;--_7:#c084fc;--_g:#3d3d6b}
[data-t="5"]{--_0:#f8fafc;--_1:#e2e8f0;--_2:#ffffff;--_3:#f1f5f9;--_d:#1e293b;--_e:#475569;--_f:#64748b;--_g:#cbd5e1;--_4:#059669}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;user-select:none;-webkit-user-select:none}
body{font-family:'Plus Jakarta Sans',-apple-system,sans-serif;background:var(--_0);color:var(--_d);line-height:1.5;transition:background .3s,color .3s}
.Z{height:100%;display:flex;flex-direction:column;padding-top:var(--_h);padding-bottom:var(--_i)}
.H{background:linear-gradient(180deg,var(--_1) 0%,var(--_0) 100%);padding:12px 16px;border-bottom:1px solid var(--_g)}
.Ht{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.L{display:flex;align-items:center;gap:10px}
.Ls{width:36px;height:36px}
.Lt{font-weight:800;font-size:17px;letter-spacing:-0.5px}
.Lt span{color:var(--_4)}
.Lb{display:flex;align-items:center;gap:4px;background:linear-gradient(135deg,#059669,#10b981);color:#fff;padding:2px 8px;border-radius:4px;font-size:9px;font-weight:700;font-family:'JetBrains Mono',monospace}
.Pb{background:var(--_2);border:1px solid var(--_c);color:var(--_c);padding:3px 8px;border-radius:16px;font-size:10px;font-weight:600;font-family:'JetBrains Mono',monospace}
.Hs{font-size:11px;color:var(--_f);font-family:'JetBrains Mono',monospace}
.Si{display:flex;align-items:center;gap:6px;font-size:10px;color:var(--_4);font-family:'JetBrains Mono',monospace}
.Sd{width:8px;height:8px;border-radius:50%;background:var(--_4);animation:P 2s infinite}
@keyframes P{0%,100%{opacity:1}50%{opacity:.5}}
.Pr{background:var(--_2);padding:10px 16px;border-bottom:1px solid var(--_g);display:flex;gap:10px;align-items:center}
.Ps{flex:1;background:var(--_3);border:1px solid var(--_g);border-radius:8px;padding:8px 12px;color:var(--_d);font-size:14px;font-family:inherit}
.Nb{background:var(--_8);border:none;color:#fff;width:36px;height:36px;border-radius:8px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.Tb{background:var(--_3);border:1px solid var(--_g);color:var(--_e);width:36px;height:36px;border-radius:8px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.M{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:12px}
.C{background:var(--_2);border-radius:14px;padding:16px;margin-bottom:12px;border:1px solid var(--_g);box-shadow:0 4px 24px rgba(0,0,0,.4)}
.Ch{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.Ci{width:28px;height:28px;background:var(--_3);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px}
.Ct{font-size:14px;font-weight:700}
.Cb{margin-left:auto;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:600;font-family:'JetBrains Mono',monospace}
.Cb1{background:rgba(16,185,129,.15);color:var(--_4)}
.Cb2{background:rgba(234,179,8,.15);color:var(--_b)}
.Cb3{background:rgba(6,182,212,.15);color:var(--_a)}
.Cb4{background:rgba(245,158,11,.15);color:var(--_8)}
.Cb5{background:rgba(139,92,246,.15);color:var(--_7)}
.Fg{margin-bottom:12px}
.Fl{display:block;font-size:11px;font-weight:600;color:var(--_e);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.Fs,.Fi{width:100%;background:var(--_3);border:2px solid var(--_g);border-radius:8px;padding:12px 14px;color:var(--_d);font-size:15px;font-family:inherit}
.Fs:focus,.Fi:focus{outline:none;border-color:var(--_6)}
.Fi::placeholder{color:var(--_f)}
.Fr{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.Tn{display:flex;background:var(--_3);border-radius:8px;padding:3px;margin-bottom:12px;overflow-x:auto}
.Tt{flex:1;padding:8px 4px;background:transparent;border:none;border-radius:6px;color:var(--_f);font-size:10px;font-weight:600;cursor:pointer;white-space:nowrap;min-width:48px}
.Tt.A{background:var(--_2);color:var(--_d);box-shadow:0 2px 6px rgba(0,0,0,.2)}
.Tc{display:none}
.Tc.A{display:block}
.Lc{background:linear-gradient(135deg,rgba(234,179,8,.1) 0%,rgba(234,179,8,.05) 100%);border:1px solid var(--_b)}
.Lp{margin-bottom:16px}
.Lph{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.Lpt{font-size:12px;color:var(--_e)}
.Lpv{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:800;color:var(--_b)}
.Lpb{height:12px;background:var(--_3);border-radius:6px;overflow:hidden}
.Lpf{height:100%;border-radius:6px;transition:width .5s}
.Lpf.low{background:var(--_9)}
.Lpf.med{background:var(--_8)}
.Lpf.good{background:var(--_b)}
.Lpf.exc{background:var(--_4)}
.Lth{display:flex;justify-content:space-between;margin-top:6px;font-size:9px;color:var(--_f);font-family:'JetBrains Mono',monospace}
.Ls2{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.Lst{background:var(--_3);border-radius:8px;padding:10px;text-align:center}
.Lsv{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;color:var(--_4)}
.Lsl{font-size:9px;color:var(--_f);text-transform:uppercase;margin-top:2px}
.Vm{display:flex;gap:6px;margin-bottom:12px}
.Vmb{flex:1;padding:10px 8px;background:var(--_3);border:2px solid var(--_g);border-radius:8px;color:var(--_f);font-size:11px;font-weight:600;cursor:pointer;text-align:center;transition:all .2s}
.Vmb.A{border-color:var(--_6);color:var(--_6);background:rgba(59,130,246,.1)}
.Vmi{font-size:18px;display:block;margin-bottom:4px}
.Dg{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.Di{text-align:center}
.Di .Fl{text-align:center}
.Pg{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;padding:12px;background:var(--_3);border-radius:8px}
.Pgi{text-align:center}
.Pgi .Fl{font-size:10px;margin-bottom:4px}
.Pgi .Fi{padding:8px;text-align:center;font-size:14px}
.Li{background:linear-gradient(135deg,rgba(99,102,241,.1) 0%,rgba(139,92,246,.1) 100%);border:2px dashed var(--_c);border-radius:10px;padding:20px;text-align:center;cursor:pointer}
.Lii{font-size:32px;margin-bottom:8px}
.Lit{font-size:12px;color:var(--_e)}
.Lih{font-size:10px;color:var(--_f);margin-top:4px}
.Cr{background:linear-gradient(135deg,rgba(16,185,129,.1) 0%,rgba(59,130,246,.1) 100%);border:1px solid var(--_4);border-radius:10px;padding:16px;text-align:center}
.Cr.E{background:var(--_3);border-color:var(--_g)}
.Crl{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--_e);margin-bottom:4px}
.Crt{font-size:36px;font-weight:800;font-family:'JetBrains Mono',monospace;color:var(--_4);line-height:1}
.Cr.E .Crt{color:var(--_f);font-size:24px}
.Cru{font-size:12px;color:var(--_e);font-family:'JetBrains Mono',monospace}
.Crb{margin-top:12px;padding-top:12px;border-top:1px solid var(--_g);font-size:11px;color:var(--_f);font-family:'JetBrains Mono',monospace}
.Bp{width:100%;padding:14px;background:linear-gradient(135deg,var(--_4) 0%,var(--_5) 100%);border:none;border-radius:10px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;box-shadow:0 4px 16px rgba(16,185,129,.3)}
.Bp:disabled{opacity:.5;pointer-events:none}
.Bs{background:var(--_3);color:var(--_e);box-shadow:none}
.Bo{background:linear-gradient(135deg,var(--_8) 0%,#d97706 100%)}
.Bv{background:linear-gradient(135deg,var(--_7) 0%,#7c3aed 100%);box-shadow:0 4px 16px rgba(139,92,246,.3)}
.Bc{background:linear-gradient(135deg,var(--_a) 0%,#0891b2 100%);box-shadow:0 4px 16px rgba(6,182,212,.3)}
.Sg{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.Ss{background:var(--_3);border-radius:8px;padding:12px;text-align:center;border:1px solid var(--_g)}
.Ss.H{border-color:var(--_4);background:rgba(16,185,129,.1)}
.Sv{font-size:22px;font-weight:800;font-family:'JetBrains Mono',monospace;color:var(--_4);line-height:1}
.Sl{font-size:9px;color:var(--_f);text-transform:uppercase;margin-top:4px}
.El,.Tl{max-height:300px;overflow-y:auto}
.Ei,.Ti{background:var(--_3);border-radius:8px;padding:12px;margin-bottom:8px;border:1px solid var(--_g)}
.Eh,.Th{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px}
.Em,.Tn2{font-weight:700;font-size:13px}
.Tn2{color:var(--_a);font-family:'JetBrains Mono',monospace}
.Es{font-size:9px;padding:2px 6px;border-radius:4px;font-family:'JetBrains Mono',monospace}
.Es1{background:rgba(59,130,246,.15);color:var(--_6)}
.Es2{background:rgba(99,102,241,.15);color:var(--_c)}
.Es3{background:rgba(6,182,212,.15);color:var(--_a)}
.Es4{background:rgba(234,179,8,.15);color:var(--_b)}
.Et,.Td{font-size:10px;color:var(--_f);font-family:'JetBrains Mono',monospace}
.Ed{display:flex;gap:12px;font-size:12px;font-family:'JetBrains Mono',monospace}
.Edt{color:var(--_e)}
.Edt strong{color:var(--_4)}
.Ep{font-size:10px;color:var(--_8);margin-top:4px}
.Edl,.Tdl{background:rgba(239,68,68,.15);border:none;color:var(--_9);padding:4px 8px;border-radius:4px;font-size:10px;cursor:pointer;margin-top:6px}
.Os{background:rgba(6,182,212,.1);border:2px dashed var(--_a);border-radius:12px;padding:24px 16px;text-align:center;cursor:pointer}
.Osi{font-size:40px;margin-bottom:8px}
.Ost{font-size:14px;font-weight:700;color:var(--_a)}
.Osx{font-size:12px;color:var(--_f)}
.Op{text-align:center;padding:24px}
.Osp{width:50px;height:50px;border:4px solid var(--_g);border-top-color:var(--_a);border-radius:50%;animation:S 1s linear infinite;margin:0 auto 12px}
@keyframes S{to{transform:rotate(360deg)}}
.Opr{font-size:13px;color:var(--_a);font-weight:600}
.Opb{width:100%;height:6px;background:var(--_3);border-radius:3px;overflow:hidden;margin-top:10px}
.Opf{height:100%;background:var(--_a);transition:width .3s}
.Or{background:var(--_3);border-radius:10px;padding:14px;margin-top:12px}
.Orr{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--_g)}
.Orr:last-child{border-bottom:none}
.Orl{font-size:11px;color:var(--_f);text-transform:uppercase}
.Orv{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:600;color:var(--_a)}
.Orv.Ed{background:var(--_2);border:1px solid var(--_g);border-radius:6px;padding:6px 10px;min-width:100px;text-align:right;color:var(--_d)}
.Il{max-height:250px;overflow-y:auto}
.It{background:var(--_3);border-radius:10px;padding:12px;margin-bottom:8px;border:1px solid var(--_g);cursor:pointer}
.It.A{border-color:var(--_8);background:rgba(245,158,11,.1)}
.Ith{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px}
.Itn{font-weight:700;font-size:14px}
.Itb{font-size:9px;padding:2px 6px;border-radius:4px;font-family:'JetBrains Mono',monospace}
.Itb.A{background:rgba(16,185,129,.15);color:var(--_4)}
.Itb.C{background:rgba(59,130,246,.15);color:var(--_6)}
.Itd{font-size:11px;color:var(--_f)}
.Its{display:flex;gap:12px;margin-top:8px;font-size:11px;font-family:'JetBrains Mono',monospace}
.Itst{color:var(--_e)}
.Itst strong{color:var(--_4)}
.Rp{background:var(--_3);border-radius:10px;padding:16px;margin-bottom:12px}
.Rsg{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px}
.Rs{background:var(--_2);border-radius:6px;padding:10px;text-align:center}
.Rsv{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700}
.Rsv.G{color:var(--_4)}
.Rsv.O{color:var(--_8)}
.Rsv.B{color:var(--_6)}
.Rsl{font-size:9px;color:var(--_f);text-transform:uppercase;margin-top:2px}
.Cc{background:var(--_2);border-radius:8px;padding:12px;margin-bottom:12px;height:180px}
.Sst{display:flex;align-items:center;gap:12px;padding:16px;background:var(--_3);border-radius:10px;margin-bottom:12px}
.Ssi{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;background:rgba(16,185,129,.15)}
.Sst2{font-weight:700;font-size:14px}
.Ssx{font-size:11px;color:var(--_f)}
.Ds{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px}
.Dst{background:var(--_3);border-radius:8px;padding:10px;text-align:center}
.Dsv{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700;color:var(--_c)}
.Dsl{font-size:8px;color:var(--_f);text-transform:uppercase}
.Sab{display:flex;align-items:center;gap:12px;padding:14px;background:var(--_3);border-radius:10px;border:1px solid var(--_g);cursor:pointer;margin-bottom:8px}
.Sai{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
.Sai.Ex{background:rgba(16,185,129,.15)}
.Sai.Im{background:rgba(59,130,246,.15)}
.Sai.Cl{background:rgba(239,68,68,.15)}
.Sat{font-weight:700;font-size:13px}
.Sad{font-size:10px;color:var(--_f)}
.Ths{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
.Tho{padding:12px 8px;background:var(--_3);border:2px solid var(--_g);border-radius:8px;text-align:center;cursor:pointer;font-size:11px;font-weight:600}
.Tho.A{border-color:var(--_4)}
.Thp{width:24px;height:24px;border-radius:50%;margin:0 auto 6px}
.Ey{text-align:center;padding:30px 16px;color:var(--_f)}
.Eyi{font-size:40px;margin-bottom:10px;opacity:.5}
.To{position:fixed;bottom:calc(var(--_i) + 16px);left:50%;transform:translateX(-50%) translateY(100px);background:var(--_4);color:#fff;padding:10px 20px;border-radius:8px;font-weight:600;font-size:13px;opacity:0;transition:all .3s;z-index:1000}
.To.S{transform:translateX(-50%) translateY(0);opacity:1}
.To.Er{background:var(--_9)}
.To.Oc{background:var(--_a)}
.To.Pu{background:var(--_7)}
.Mo{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:all .3s;padding:16px}
.Mo.S{opacity:1;visibility:visible}
.Md{background:var(--_2);border-radius:14px;padding:20px;max-width:380px;width:100%;border:1px solid var(--_g);max-height:90vh;overflow-y:auto}
.Mt{font-size:16px;font-weight:700;margin-bottom:16px}
.Mb{display:flex;gap:10px;margin-top:16px}
.Mbc{flex:1;padding:12px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;border:none;background:var(--_3);color:var(--_e)}
.Mbf{background:var(--_8);color:#fff}
.Hi{display:none}
.Cp{text-align:center;padding:16px;font-size:10px;color:var(--_f);border-top:1px solid var(--_g);margin-top:20px}
.Cp strong{color:var(--_4)}
/* Stream breakdown table */
.Stb{width:100%;border-collapse:collapse;margin:12px 0;font-size:11px}
.Stb th{background:var(--_3);padding:8px 6px;text-align:left;font-weight:600;color:var(--_e);text-transform:uppercase;font-size:9px;border-bottom:2px solid var(--_g)}
.Stb td{padding:8px 6px;border-bottom:1px solid var(--_g)}
.Stb tr:last-child td{border-bottom:none;font-weight:700;background:rgba(16,185,129,.1)}
.Stb .num{text-align:right;font-family:'JetBrains Mono',monospace}
.Stb .rate{color:var(--_4);font-weight:600}
.Stb .rate.low{color:var(--_9)}
.Stb .rate.med{color:var(--_8)}
</style>
</head>
<body oncontextmenu="return false" oncopy="return false" oncut="return false">
<div class="Z">
<header class="H">
<div class="Ht">
<div class="L">
<svg class="Ls" viewBox="0 0 100 100" fill="none"><circle cx="50" cy="50" r="45" stroke="url(#g1)" stroke-width="4" fill="none"/><path d="M50 15 L70 45 L58 45 L58 65 L42 65 L42 45 L30 45 Z" fill="var(--_4)"/><path d="M50 15 L70 45 L58 45 L58 65 L42 65 L42 45 L30 45 Z" fill="var(--_6)" transform="rotate(120 50 50)"/><path d="M50 15 L70 45 L58 45 L58 65 L42 65 L42 45 L30 45 Z" fill="var(--_4)" transform="rotate(240 50 50)"/><text x="50" y="58" text-anchor="middle" font-family="Plus Jakarta Sans" font-weight="800" font-size="22" fill="var(--_4)">D</text><defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:var(--_4)"/><stop offset="100%" style="stop-color:var(--_6)"/></linearGradient></defs></svg>
<div class="Lt">Diversion<span>Scan</span>‚Ñ¢</div>
</div>
<div style="display:flex;align-items:center;gap:8px">
<div class="Lb">‚úì LEED v4.1</div>
<div class="Pb">ENTERPRISE</div>
</div>
</div>
<div style="display:flex;justify-content:space-between;align-items:center">
<div class="Hs">C&D Waste Stream Tracking</div>
<div class="Si"><div class="Sd"></div><span id="st">Synced</span></div>
</div>
</header>
<div class="Pr">
<select id="ps" class="Ps"><option value="">‚Äî Select Project ‚Äî</option></select>
<button class="Nb" onclick="$('pm').classList.add('S')">+</button>
<button class="Tb" onclick="$('tm').classList.add('S')">üé®</button>
</div>
<main class="M">
<div class="Tn">
<button class="Tt A" data-t="calc">‚öñÔ∏è Calc</button>
<button class="Tt" data-t="ocr">üé´ OCR</button>
<button class="Tt" data-t="proj">üìÅ</button>
<button class="Tt" data-t="log">üìã</button>
<button class="Tt" data-t="strm">üìä</button>
<button class="Tt" data-t="rpt">üìÑ</button>
<button class="Tt" data-t="set">‚öôÔ∏è</button>
</div>

<div id="calc" class="Tc A">
<div id="lc" class="C Lc" style="display:none">
<div class="Ch"><div class="Ci">üèÜ</div><div class="Ct">LEED v4.1 MRc5</div><div class="Cb Cb2">TRACKING</div></div>
<div class="Lp">
<div class="Lph"><span class="Lpt">Diversion Rate</span><span class="Lpv" id="lr">0%</span></div>
<div class="Lpb"><div class="Lpf" id="lf" style="width:0%"></div></div>
<div class="Lth"><span>0%</span><span>50% (1pt)</span><span>75% (2pts)</span><span>100%</span></div>
</div>
<div class="Ls2">
<div class="Lst"><div class="Lsv" id="ld">0</div><div class="Lsl">Diverted</div></div>
<div class="Lst"><div class="Lsv" id="ll">0</div><div class="Lsl">Landfill</div></div>
<div class="Lst"><div class="Lsv" id="lt">0</div><div class="Lsl">Total</div></div>
</div>
</div>
<div class="C">
<div class="Ch"><div class="Ci">üèóÔ∏è</div><div class="Ct">Material Stream</div></div>
<div class="Fg">
<label class="Fl">C&D Material Type</label>
<select id="ms" class="Fs">
<option value="">Select material stream...</option>
<optgroup label="ü™® Concrete & Masonry">
<option value="Concrete" data-d="1.10" data-cat="Concrete">Concrete (Clean) - 1.10 t/CY</option>
<option value="Concrete w/Rebar" data-d="1.25" data-cat="Concrete">Concrete w/ Rebar - 1.25 t/CY</option>
<option value="Brick/CMU" data-d="1.00" data-cat="Concrete">Brick/CMU - 1.00 t/CY</option>
</optgroup>
<optgroup label="üõ£Ô∏è Asphalt">
<option value="Asphalt" data-d="1.10" data-cat="Asphalt">Asphalt Pavement - 1.10 t/CY</option>
<option value="Shingles" data-d="0.40" data-cat="Asphalt">Roofing Shingles - 0.40 t/CY</option>
</optgroup>
<optgroup label="ü™µ Wood">
<option value="Clean Wood" data-d="0.30" data-cat="Wood">Clean Wood - 0.30 t/CY</option>
<option value="Painted Wood" data-d="0.35" data-cat="Wood">Painted/Treated Wood - 0.35 t/CY</option>
<option value="Pallets" data-d="0.25" data-cat="Wood">Pallets - 0.25 t/CY</option>
</optgroup>
<optgroup label="üî© Metal">
<option value="Heavy Metal" data-d="0.50" data-cat="Metal">Heavy Metal/Steel - 0.50 t/CY</option>
<option value="Light Gauge Metal" data-d="0.35" data-cat="Metal">Light Gauge Metal - 0.35 t/CY</option>
<option value="Mixed Metal" data-d="0.40" data-cat="Metal">Mixed Metals - 0.40 t/CY</option>
</optgroup>
<optgroup label="üß± Drywall">
<option value="Clean Drywall" data-d="0.35" data-cat="Drywall">Clean Drywall - 0.35 t/CY</option>
<option value="Contaminated Drywall" data-d="0.40" data-cat="Drywall">Contaminated Drywall - 0.40 t/CY</option>
</optgroup>
<optgroup label="üì¶ Cardboard/Paper">
<option value="Cardboard/OCC" data-d="0.10" data-cat="Cardboard">Cardboard/OCC - 0.10 t/CY</option>
<option value="Mixed Paper" data-d="0.12" data-cat="Cardboard">Mixed Paper - 0.12 t/CY</option>
</optgroup>
<optgroup label="‚ôªÔ∏è Plastic">
<option value="Plastic Film" data-d="0.08" data-cat="Plastic">Plastic Film - 0.08 t/CY</option>
<option value="Rigid Plastic" data-d="0.15" data-cat="Plastic">Rigid Plastic - 0.15 t/CY</option>
</optgroup>
<optgroup label="üèîÔ∏è Other">
<option value="Fill Dirt" data-d="1.10" data-cat="Soil">Clean Fill Dirt - 1.10 t/CY</option>
<option value="Land Clearing" data-d="0.35" data-cat="Organics">Land Clearing Debris - 0.35 t/CY</option>
<option value="Mixed C&D" data-d="0.40" data-cat="Mixed">Mixed C&D - 0.40 t/CY</option>
</optgroup>
</select>
</div>
<div class="Vm">
<button class="Vmb A" data-m="man"><span class="Vmi">‚úèÔ∏è</span>Manual</button>
<button class="Vmb" data-m="dim"><span class="Vmi">üìè</span>L√óW√óH</button>
<button class="Vmb" data-m="lid"><span class="Vmi">üì±</span>LiDAR</button>
<button class="Vmb" data-m="pct"><span class="Vmi">%</span>Split</button>
</div>
<div id="vi-man">
<div class="Fg"><label class="Fl">Volume (CY)</label><input type="number" id="vi" class="Fi" placeholder="0.00" step="0.01" min="0" inputmode="decimal"></div>
</div>
<div id="vi-dim" style="display:none">
<div class="Dg">
<div class="Di"><label class="Fl">Length (ft)</label><input type="number" id="vl" class="Fi" placeholder="0" step="0.5" min="0" inputmode="decimal"></div>
<div class="Di"><label class="Fl">Width (ft)</label><input type="number" id="vw" class="Fi" placeholder="0" step="0.5" min="0" inputmode="decimal"></div>
<div class="Di"><label class="Fl">Height (ft)</label><input type="number" id="vh" class="Fi" placeholder="0" step="0.5" min="0" inputmode="decimal"></div>
</div>
<div style="text-align:center;font-size:11px;color:var(--_f)">Volume: <span id="cv">0.00</span> CY</div>
</div>
<div id="vi-lid" style="display:none">
<div class="Li" onclick="$('lf2').click()">
<div class="Lii">üì±</div>
<div class="Lit">Import from 3D Scanner</div>
<div class="Lih">Polycam, Canvas, or manual</div>
</div>
<input type="file" id="lf2" class="Hi" accept=".json,.csv,.txt">
<div class="Fg" style="margin-top:12px"><label class="Fl">Or Enter LiDAR Volume (CY)</label><input type="number" id="vli" class="Fi" placeholder="0.00" step="0.01" min="0" inputmode="decimal"></div>
</div>
<div id="vi-pct" style="display:none">
<div class="Fg"><label class="Fl">Total Weight (tons)</label><input type="number" id="tw" class="Fi" placeholder="0.00" step="0.01" min="0" inputmode="decimal"></div>
<div class="Pg">
<div class="Pgi"><label class="Fl">‚ôªÔ∏è Diverted %</label><input type="number" id="dp" class="Fi" value="75" min="0" max="100"></div>
<div class="Pgi"><label class="Fl">üóëÔ∏è Landfill %</label><input type="number" id="lp" class="Fi" value="25" min="0" max="100"></div>
</div>
<div id="pb" style="font-size:11px;color:var(--_f);text-align:center;font-family:'JetBrains Mono',monospace">Diverted: 0.00t | Landfill: 0.00t</div>
</div>
<div class="Fg" id="dg">
<label class="Fl">Destination</label>
<select id="ds" class="Fs"><option value="d">‚ôªÔ∏è Diverted/Recycled</option><option value="l">üóëÔ∏è Landfill</option></select>
</div>
</div>
<div class="C">
<div class="Ch"><div class="Ci">‚öñÔ∏è</div><div class="Ct">Tonnage</div></div>
<div id="cr" class="Cr E">
<div class="Crl">Estimated Weight</div>
<div id="td" class="Crt">--</div>
<div class="Cru">tons</div>
<div id="cb" class="Crb" style="display:none"></div>
</div>
<button id="ab" class="Bp" style="margin-top:12px" disabled>‚ûï Add Entry</button>
</div>
</div>

<div id="ocr" class="Tc">
<div class="C">
<div class="Ch"><div class="Ci">üì∑</div><div class="Ct">Scan Scale Ticket</div><div class="Cb Cb3">OCR</div></div>
<div id="osa">
<div class="Os" onclick="$('ci').click()">
<div class="Osi">üì∑</div>
<div class="Ost">Tap to Scan Ticket</div>
<div class="Osx">Camera captures scale ticket</div>
</div>
</div>
<div id="opr" class="Op" style="display:none">
<div class="Osp"></div>
<div class="Opr" id="opt">Processing...</div>
<div class="Opb"><div class="Opf" id="opf" style="width:0%"></div></div>
</div>
<div id="ors" class="Or" style="display:none">
<div class="Orr"><span class="Orl">Ticket #</span><input type="text" id="ot" class="Orv Ed"></div>
<div class="Orr"><span class="Orl">Gross (lbs)</span><input type="number" id="og" class="Orv Ed"></div>
<div class="Orr"><span class="Orl">Tare (lbs)</span><input type="number" id="ota" class="Orv Ed"></div>
<div class="Orr"><span class="Orl">Net Weight</span><span id="on" class="Orv" style="color:var(--_4)">-- tons</span></div>
<div style="display:flex;gap:8px;margin-top:12px">
<button class="Bp Bc" onclick="_st()" style="flex:1">üíæ Save</button>
<button class="Bp Bs" onclick="_ro()" style="flex:.4">üîÑ</button>
</div>
</div>
</div>
<div class="C">
<div class="Ch"><div class="Ci">üé´</div><div class="Ct">Saved Tickets</div></div>
<div id="tl" class="Tl"><div class="Ey"><div class="Eyi">üé´</div><div>No tickets</div></div></div>
</div>
</div>

<div id="proj" class="Tc">
<div class="C">
<div class="Ch"><div class="Ci">üè¢</div><div class="Ct">Customers</div><button class="Cb Cb4" style="cursor:pointer;border:none" onclick="$('cm').classList.add('S')">+ ADD</button></div>
<div id="cl" class="Il"><div class="Ey"><div class="Eyi">üè¢</div><div>No customers</div></div></div>
</div>
<div class="C">
<div class="Ch"><div class="Ci">üìÅ</div><div class="Ct">Projects</div><button class="Cb Cb4" style="cursor:pointer;border:none" onclick="$('pm').classList.add('S')">+ ADD</button></div>
<div id="pl" class="Il"><div class="Ey"><div class="Eyi">üìÅ</div><div>No projects</div></div></div>
</div>
</div>

<div id="log" class="Tc">
<div class="C">
<div class="Ch"><div class="Ci">üìä</div><div class="Ct">Summary</div></div>
<div class="Sg">
<div class="Ss H"><div id="tt" class="Sv">0</div><div class="Sl">Total Tons</div></div>
<div class="Ss"><div id="dt" class="Sv">0</div><div class="Sl">Diverted</div></div>
<div class="Ss"><div id="ec" class="Sv">0</div><div class="Sl">Entries</div></div>
<div class="Ss"><div id="dr" class="Sv">0%</div><div class="Sl">Rate</div></div>
</div>
</div>
<div class="C">
<div class="Ch"><div class="Ci">üìù</div><div class="Ct">Entry Log</div><button id="clb" class="Cb" style="cursor:pointer;background:rgba(239,68,68,.15);color:var(--_9);border:none">CLEAR</button></div>
<div id="el" class="El"><div class="Ey"><div class="Eyi">üìã</div><div>No entries</div></div></div>
</div>
</div>

<!-- NEW: Stream Breakdown Tab -->
<div id="strm" class="Tc">
<div class="C">
<div class="Ch"><div class="Ci">üìä</div><div class="Ct">Material Stream Breakdown</div><div class="Cb Cb2">LEED</div></div>
<div id="strm-empty" class="Ey"><div class="Eyi">üìä</div><div>No data yet</div></div>
<div id="strm-data" style="display:none">
<table class="Stb">
<thead>
<tr><th>Material Stream</th><th class="num">Total</th><th class="num">Diverted</th><th class="num">Landfill</th><th class="num">Rate</th></tr>
</thead>
<tbody id="strm-body"></tbody>
</table>
</div>
</div>
<div class="C">
<div class="Ch"><div class="Ci">üìà</div><div class="Ct">Stream Composition</div></div>
<div class="Cc"><canvas id="strm-chart"></canvas></div>
</div>
</div>

<div id="rpt" class="Tc">
<div class="C">
<div class="Ch"><div class="Ci">üìÑ</div><div class="Ct">LEED MRc5 Report</div><div class="Cb Cb5">PDF</div></div>
<div id="rnp" class="Ey"><div class="Eyi">üìÅ</div><div>Select project first</div></div>
<div id="rc" style="display:none">
<div class="Fg"><label class="Fl">Prepared By</label><input type="text" id="pby" class="Fi" placeholder="Your Name"></div>
<div class="Rp">
<div class="Rsg">
<div class="Rs"><div class="Rsv G" id="rt">0</div><div class="Rsl">Total Tons</div></div>
<div class="Rs"><div class="Rsv G" id="rd">0</div><div class="Rsl">Diverted</div></div>
<div class="Rs"><div class="Rsv O" id="rl">0</div><div class="Rsl">Landfill</div></div>
<div class="Rs"><div class="Rsv B" id="rr">0%</div><div class="Rsl">Rate</div></div>
</div>
</div>
<div class="Cc"><canvas id="ch"></canvas></div>
<button class="Bp Bv" onclick="_gp()">üìÑ Generate LEED Report</button>
</div>
</div>
</div>

<div id="set" class="Tc">
<div class="C">
<div class="Ch"><div class="Ci">üé®</div><div class="Ct">Theme</div></div>
<div class="Ths">
<div class="Tho A" data-t="0" onclick="_th(0)"><div class="Thp" style="background:linear-gradient(135deg,#10b981,#3b82f6)"></div>Default</div>
<div class="Tho" data-t="1" onclick="_th(1)"><div class="Thp" style="background:linear-gradient(135deg,#00d4aa,#00b4d8)"></div>Ocean</div>
<div class="Tho" data-t="2" onclick="_th(2)"><div class="Thp" style="background:linear-gradient(135deg,#ff6b6b,#ffa500)"></div>Sunset</div>
<div class="Tho" data-t="3" onclick="_th(3)"><div class="Thp" style="background:linear-gradient(135deg,#4ade80,#86efac)"></div>Forest</div>
<div class="Tho" data-t="4" onclick="_th(4)"><div class="Thp" style="background:linear-gradient(135deg,#a78bfa,#818cf8)"></div>Night</div>
<div class="Tho" data-t="5" onclick="_th(5)"><div class="Thp" style="background:linear-gradient(135deg,#f8fafc,#e2e8f0);border:1px solid #cbd5e1"></div>Light</div>
</div>
</div>
<div class="C">
<div class="Ch"><div class="Ci">‚òÅÔ∏è</div><div class="Ct">Data</div></div>
<div class="Sst"><div class="Ssi">‚úÖ</div><div><div class="Sst2">Saved Locally</div><div class="Ssx">Last: <span id="ls">Just now</span></div></div></div>
<div class="Ds">
<div class="Dst"><div class="Dsv" id="sc">0</div><div class="Dsl">Customers</div></div>
<div class="Dst"><div class="Dsv" id="sp">0</div><div class="Dsl">Projects</div></div>
<div class="Dst"><div class="Dsv" id="se">0</div><div class="Dsl">Entries</div></div>
<div class="Dst"><div class="Dsv" id="stk">0</div><div class="Dsl">Tickets</div></div>
</div>
<div class="Sab" onclick="_ex()"><div class="Sai Ex">üì§</div><div><div class="Sat">Export</div><div class="Sad">Download backup</div></div></div>
<div class="Sab" onclick="$('ii').click()"><div class="Sai Im">üì•</div><div><div class="Sat">Import</div><div class="Sad">Restore backup</div></div></div>
<div class="Sab" onclick="if(confirm('Clear ALL data?')){localStorage.clear();location.reload()}"><div class="Sai Cl">üóëÔ∏è</div><div><div class="Sat">Clear All</div><div class="Sad">Remove data</div></div></div>
</div>
<div class="Cp"><strong>DiversionScan‚Ñ¢</strong><br>Powered by <strong>Dalmex Recycling, LLC</strong><br>¬© 2025 All Rights Reserved<br>LEED v4.1 MRc5 Compliant</div>
</div>
</main>
</div>

<input type="file" id="ci" class="Hi" accept="image/*" capture="environment">
<input type="file" id="ii" class="Hi" accept=".json">
<div id="to" class="To"></div>

<div id="cm" class="Mo"><div class="Md">
<div class="Mt">üè¢ Add Customer</div>
<div class="Fg"><label class="Fl">Company</label><input type="text" id="cn" class="Fi" placeholder="ABC Construction"></div>
<div class="Fg"><label class="Fl">Contact</label><input type="text" id="cc" class="Fi" placeholder="John Smith"></div>
<div class="Fg"><label class="Fl">Phone</label><input type="tel" id="cp" class="Fi" placeholder="(214) 555-1234"></div>
<div class="Mb"><button class="Mbc" onclick="this.closest('.Mo').classList.remove('S')">Cancel</button><button class="Mbc Mbf" onclick="_sc()">Save</button></div>
</div></div>

<div id="pm" class="Mo"><div class="Md">
<div class="Mt">üìÅ Add Project</div>
<div class="Fg"><label class="Fl">Project Name</label><input type="text" id="pn" class="Fi" placeholder="Downtown Demo"></div>
<div class="Fg"><label class="Fl">Customer</label><select id="pc" class="Fs"><option value="">Select...</option></select></div>
<div class="Fg"><label class="Fl">Address</label><input type="text" id="pa" class="Fi" placeholder="123 Main St"></div>
<div class="Fr">
<div class="Fg"><label class="Fl">LEED Target</label><select id="plt" class="Fs"><option value="n">No LEED</option><option value="50">50% (1pt)</option><option value="75">75% (2pts)</option></select></div>
<div class="Fg"><label class="Fl">Status</label><select id="pst" class="Fs"><option value="a">Active</option><option value="c">Completed</option></select></div>
</div>
<div class="Mb"><button class="Mbc" onclick="this.closest('.Mo').classList.remove('S')">Cancel</button><button class="Mbc Mbf" onclick="_sp()">Save</button></div>
</div></div>

<div id="tm" class="Mo"><div class="Md">
<div class="Mt">üé® Theme</div>
<div class="Ths">
<div class="Tho A" data-t="0" onclick="_th(0);this.closest('.Mo').classList.remove('S')"><div class="Thp" style="background:linear-gradient(135deg,#10b981,#3b82f6)"></div>Default</div>
<div class="Tho" data-t="1" onclick="_th(1);this.closest('.Mo').classList.remove('S')"><div class="Thp" style="background:linear-gradient(135deg,#00d4aa,#00b4d8)"></div>Ocean</div>
<div class="Tho" data-t="2" onclick="_th(2);this.closest('.Mo').classList.remove('S')"><div class="Thp" style="background:linear-gradient(135deg,#ff6b6b,#ffa500)"></div>Sunset</div>
<div class="Tho" data-t="3" onclick="_th(3);this.closest('.Mo').classList.remove('S')"><div class="Thp" style="background:linear-gradient(135deg,#4ade80,#86efac)"></div>Forest</div>
<div class="Tho" data-t="4" onclick="_th(4);this.closest('.Mo').classList.remove('S')"><div class="Thp" style="background:linear-gradient(135deg,#a78bfa,#818cf8)"></div>Night</div>
<div class="Tho" data-t="5" onclick="_th(5);this.closest('.Mo').classList.remove('S')"><div class="Thp" style="background:linear-gradient(135deg,#f8fafc,#e2e8f0);border:1px solid #cbd5e1"></div>Light</div>
</div>
<div class="Mb"><button class="Mbc" onclick="this.closest('.Mo').classList.remove('S')" style="flex:1">Close</button></div>
</div></div>

<script>
/*! DiversionScan‚Ñ¢ ¬© 2025 Dalmex Recycling, LLC. All Rights Reserved. */
const $=id=>document.getElementById(id),{jsPDF:_J}=window.jspdf;
let _c=[],_p=[],_e=[],_t=[],_cp=null,_vm='man',_ch=null,_sch=null,_th_=0;

// Material categories for LEED reporting
const _cats=['Concrete','Asphalt','Wood','Metal','Drywall','Cardboard','Plastic','Soil','Organics','Mixed'];
const _catColors=['#6b7280','#374151','#92400e','#0891b2','#dc2626','#ca8a04','#7c3aed','#65a30d','#059669','#f59e0b'];

const _tn=document.querySelectorAll('.Tt'),_tc=document.querySelectorAll('.Tc');
_tn.forEach(b=>b.onclick=()=>{_tn.forEach(x=>x.classList.remove('A'));_tc.forEach(x=>x.classList.remove('A'));b.classList.add('A');$(b.dataset.t).classList.add('A');if(b.dataset.t==='rpt')_ur();if(b.dataset.t==='strm')_usb()});

const _vb=document.querySelectorAll('.Vmb');
_vb.forEach(b=>b.onclick=()=>{_vb.forEach(x=>x.classList.remove('A'));b.classList.add('A');_vm=b.dataset.m;$('vi-man').style.display=_vm==='man'?'block':'none';$('vi-dim').style.display=_vm==='dim'?'block':'none';$('vi-lid').style.display=_vm==='lid'?'block':'none';$('vi-pct').style.display=_vm==='pct'?'block':'none';$('dg').style.display=_vm==='pct'?'none':'block';_calc()});

function _th(t){_th_=t;if(t===0)document.body.removeAttribute('data-t');else document.body.setAttribute('data-t',t);document.querySelectorAll('.Tho').forEach(o=>o.classList.toggle('A',parseInt(o.dataset.t)===t));localStorage.setItem('_th',t)}
const _sth=localStorage.getItem('_th');if(_sth)_th(parseInt(_sth));

function _upb(){const tw=parseFloat($('tw').value)||0,dp=parseFloat($('dp').value)||0,lp=parseFloat($('lp').value)||0;$('pb').innerHTML=`‚ôªÔ∏è <strong style="color:var(--_4)">${(tw*dp/100).toFixed(2)}</strong>t | üóëÔ∏è <strong style="color:var(--_8)">${(tw*lp/100).toFixed(2)}</strong>t`;_calc()}
$('tw')?.addEventListener('input',_upb);
$('dp')?.addEventListener('input',()=>{$('lp').value=Math.max(0,100-parseFloat($('dp').value)||0);_upb()});
$('lp')?.addEventListener('input',()=>{$('dp').value=Math.max(0,100-parseFloat($('lp').value)||0);_upb()});

function _gv(){if(_vm==='man')return parseFloat($('vi').value)||0;if(_vm==='dim'){const l=parseFloat($('vl').value)||0,w=parseFloat($('vw').value)||0,h=parseFloat($('vh').value)||0;return(l*w*h)/27}if(_vm==='lid')return parseFloat($('vli').value)||0;return 0}

function _calc(){if(_vm==='pct'){const tw=parseFloat($('tw').value)||0;if(tw>0){$('td').textContent=tw.toFixed(2);$('cr').classList.remove('E');$('cb').innerHTML='Split by %';$('cb').style.display='block';$('ab').disabled=false}else{$('td').textContent='--';$('cr').classList.add('E');$('cb').style.display='none';$('ab').disabled=true}return}const v=_gv(),o=$('ms').options[$('ms').selectedIndex],d=parseFloat(o?.dataset?.d)||0;if(_vm==='dim')$('cv').textContent=v.toFixed(2);if(v>0&&d>0){const t=v*d;$('td').textContent=t.toFixed(2);$('cr').classList.remove('E');$('cb').innerHTML=`${v.toFixed(2)} CY √ó ${d.toFixed(2)} t/CY`;$('cb').style.display='block';$('ab').disabled=false}else{$('td').textContent='--';$('cr').classList.add('E');$('cb').style.display='none';$('ab').disabled=true}}

$('ms').onchange=_calc;$('vi').oninput=_calc;$('vl')?.addEventListener('input',_calc);$('vw')?.addEventListener('input',_calc);$('vh')?.addEventListener('input',_calc);$('vli')?.addEventListener('input',_calc);

$('ab').onclick=()=>{const o=$('ms').options[$('ms').selectedIndex];const cat=o?.dataset?.cat||'Mixed';if(_vm==='pct'){const tw=parseFloat($('tw').value)||0,dp=parseFloat($('dp').value)||0,lp=parseFloat($('lp').value)||0;if(tw<=0)return;const dv=tw*dp/100,lv=tw*lp/100,mn=o?.value||'Mixed C&D';if(dv>0)_e.unshift({id:Date.now(),m:mn,cat:cat,v:0,d:0,t:dv,dst:'d',src:'pct',pid:_cp?.id||null,pn:_cp?.n||null,ts:new Date().toISOString()});if(lv>0)_e.unshift({id:Date.now()+1,m:mn,cat:cat,v:0,d:0,t:lv,dst:'l',src:'pct',pid:_cp?.id||null,pn:_cp?.n||null,ts:new Date().toISOString()});$('tw').value='';_upb()}else{const v=_gv(),d=parseFloat(o?.dataset?.d)||0,t=v*d;if(t<=0)return;_e.unshift({id:Date.now(),m:o.value,cat:cat,v,d,t,dst:$('ds').value,src:_vm,pid:_cp?.id||null,pn:_cp?.n||null,ts:new Date().toISOString()})}_sv();_ua();_rc();_to('‚úÖ Entry added!')};

function _rc(){$('ms').value='';$('vi').value='';$('vl').value='';$('vw').value='';$('vh').value='';$('vli').value='';_calc()}
$('ps').onchange=()=>{_cp=_p.find(p=>p.id==$('ps').value)||null;_ua()};

// OCR
$('ci').onchange=async e=>{const f=e.target.files[0];if(!f)return;$('osa').style.display='none';$('opr').style.display='block';$('ors').style.display='none';try{const r=await Tesseract.recognize(f,'eng',{logger:m=>{if(m.status==='recognizing text'){const p=Math.round(m.progress*100);$('opt').textContent=`Processing... ${p}%`;$('opf').style.width=`${p}%`}}});const txt=r.data.text,pr=_pt(txt);$('ot').value=pr.tk||'';$('og').value=pr.gr||'';$('ota').value=pr.ta||'';_uon();$('opr').style.display='none';$('ors').style.display='block';_to('üé´ Scanned!','Oc')}catch(er){console.error(er);_ro();_to('‚ùå Failed','Er')}e.target.value=''};
function _pt(t){const r={tk:'',gr:'',ta:''};const tm=t.match(/(?:ticket|#|no\.?)[:\s]*([A-Z0-9-]+)/i);if(tm)r.tk=tm[1];const ws=[];const wr=/(\d{1,3}(?:,?\d{3})*(?:\.\d{1,2})?)\s*(?:lbs?|#|pounds?)?/gi;let m;while((m=wr.exec(t))!==null){const n=parseFloat(m[1].replace(/,/g,''));if(n>1000&&n<200000)ws.push(n)}ws.sort((a,b)=>b-a);if(ws.length>=2){r.gr=ws[0];r.ta=ws[1]}else if(ws.length===1)r.gr=ws[0];return r}
function _uon(){const g=parseFloat($('og').value)||0,ta=parseFloat($('ota').value)||0,n=g-ta;$('on').textContent=n>0?`${(n/2000).toFixed(2)} tons`:'-- tons'}
$('og')?.addEventListener('input',_uon);$('ota')?.addEventListener('input',_uon);
function _ro(){$('osa').style.display='block';$('opr').style.display='none';$('ors').style.display='none'}
function _st(){const g=parseFloat($('og').value)||0,ta=parseFloat($('ota').value)||0,n=g-ta;if(n<=0){_to('‚ùå Invalid','Er');return}_t.unshift({id:Date.now(),tk:$('ot').value||`TKT-${Date.now()}`,gr:g,ta,n,nt:n/2000,pid:_cp?.id||null,ts:new Date().toISOString()});_sv();_utl();_ro();_to('üé´ Saved!','Oc')}

// Customer/Project
function _sc(){const n=$('cn').value.trim();if(!n){_to('‚ùå Enter name','Er');return}_c.push({id:Date.now(),n,ct:$('cc').value.trim(),ph:$('cp').value.trim()});_sv();_ucl();_upc();$('cm').classList.remove('S');$('cn').value='';$('cc').value='';$('cp').value='';_to('üè¢ Added!')}
function _sp(){const n=$('pn').value.trim();if(!n){_to('‚ùå Enter name','Er');return}const cid=$('pc').value,c=_c.find(x=>x.id==cid);_p.push({id:Date.now(),n,cid:cid?parseInt(cid):null,cn:c?.n||null,ad:$('pa').value.trim(),lt:$('plt').value,st:$('pst').value});_sv();_ua();$('pm').classList.remove('S');$('pn').value='';$('pa').value='';_to('üìÅ Added!')}

// Update all
function _ua(){_uel();_us();_ulc();_upl();_ucl();_ups();_utl();_uss();_ur();_usb()}

function _uel(){const l=$('el'),f=_cp?_e.filter(e=>e.pid===_cp.id):_e;if(!f.length){l.innerHTML='<div class="Ey"><div class="Eyi">üìã</div><div>No entries</div></div>';return}l.innerHTML=f.slice(0,50).map(e=>`<div class="Ei"><div class="Eh"><div><div class="Em">${e.m}</div><span class="Es ${e.src==='lid'?'Es2':e.src==='ocr'?'Es3':e.src==='pct'?'Es4':'Es1'}">${e.src==='lid'?'üì± LiDAR':e.src==='ocr'?'üé´ OCR':e.src==='pct'?'% Split':'‚úèÔ∏è Manual'}</span></div><div class="Et">${new Date(e.ts).toLocaleDateString()}</div></div><div class="Ed"><div class="Edt"><strong>${e.t.toFixed(2)}</strong> tons</div>${e.v?`<div class="Edt">${e.v.toFixed(2)} CY</div>`:''}<div class="Edt">${e.dst==='d'?'‚ôªÔ∏è':'üóëÔ∏è'}</div></div>${e.pn?`<div class="Ep">üìÅ ${e.pn}</div>`:''}<button class="Edl" onclick="_de(${e.id})">üóëÔ∏è</button></div>`).join('')}
function _de(id){_e=_e.filter(e=>e.id!==id);_sv();_ua();_to('üóëÔ∏è Deleted')}

function _us(){const f=_cp?_e.filter(e=>e.pid===_cp.id):_e,tot=f.reduce((s,e)=>s+e.t,0),dv=f.filter(e=>e.dst==='d').reduce((s,e)=>s+e.t,0),rt=tot>0?(dv/tot)*100:0;$('tt').textContent=tot.toFixed(1);$('dt').textContent=dv.toFixed(1);$('ec').textContent=f.length;$('dr').textContent=rt.toFixed(0)+'%'}

function _ulc(){const c=$('lc');if(!_cp||_cp.lt==='n'){c.style.display='none';return}c.style.display='block';const f=_e.filter(e=>e.pid===_cp.id),tot=f.reduce((s,e)=>s+e.t,0),dv=f.filter(e=>e.dst==='d').reduce((s,e)=>s+e.t,0),lf=tot-dv,rt=tot>0?(dv/tot)*100:0;$('lr').textContent=rt.toFixed(0)+'%';$('ld').textContent=dv.toFixed(1);$('ll').textContent=lf.toFixed(1);$('lt').textContent=tot.toFixed(1);const fl=$('lf');fl.style.width=Math.min(rt,100)+'%';fl.className='Lpf '+(rt>=75?'exc':rt>=50?'good':rt>=25?'med':'low')}

function _upl(){const l=$('pl');if(!_p.length){l.innerHTML='<div class="Ey"><div class="Eyi">üìÅ</div><div>No projects</div></div>';return}l.innerHTML=_p.map(p=>{const f=_e.filter(e=>e.pid===p.id),tot=f.reduce((s,e)=>s+e.t,0),dv=f.filter(e=>e.dst==='d').reduce((s,e)=>s+e.t,0),rt=tot>0?(dv/tot*100).toFixed(0):0;return`<div class="It ${_cp?.id===p.id?'A':''}" onclick="_selp(${p.id})"><div class="Ith"><div class="Itn">${p.n}</div><div class="Itb ${p.st==='a'?'A':'C'}">${p.st==='a'?'Active':'Done'}</div></div><div class="Itd">${p.cn||'No customer'}</div><div class="Its"><div class="Itst"><strong>${tot.toFixed(1)}</strong> tons</div><div class="Itst"><strong>${rt}%</strong></div></div></div>`}).join('')}
function _selp(id){_cp=_p.find(p=>p.id===id)||null;$('ps').value=id;_ua();document.querySelector('[data-t="calc"]').click();_to(`üìÅ ${_cp.n}`)}

function _ucl(){const l=$('cl');if(!_c.length){l.innerHTML='<div class="Ey"><div class="Eyi">üè¢</div><div>No customers</div></div>';return}l.innerHTML=_c.map(c=>{const pc=_p.filter(p=>p.cid===c.id).length;return`<div class="It"><div class="Ith"><div class="Itn">${c.n}</div><div class="Itb A">${pc} proj</div></div><div class="Itd">${c.ct||''} ${c.ph||''}</div></div>`}).join('')}

function _ups(){$('ps').innerHTML='<option value="">‚Äî Select Project ‚Äî</option>'+_p.filter(p=>p.st==='a').map(p=>`<option value="${p.id}" ${_cp?.id===p.id?'selected':''}>${p.n}</option>`).join('');$('pc').innerHTML='<option value="">Select...</option>'+_c.map(c=>`<option value="${c.id}">${c.n}</option>`).join('')}
function _upc(){$('pc').innerHTML='<option value="">Select...</option>'+_c.map(c=>`<option value="${c.id}">${c.n}</option>`).join('')}

function _utl(){const l=$('tl');if(!_t.length){l.innerHTML='<div class="Ey"><div class="Eyi">üé´</div><div>No tickets</div></div>';return}l.innerHTML=_t.slice(0,20).map(t=>`<div class="Ti"><div class="Th"><div class="Tn2">#${t.tk}</div><div class="Td">${new Date(t.ts).toLocaleDateString()}</div></div><div class="Ed"><div class="Edt"><strong>${t.nt.toFixed(2)}</strong> tons</div><div class="Edt">${t.n.toLocaleString()} lbs</div></div><button class="Tdl" onclick="_dt(${t.id})">üóëÔ∏è</button></div>`).join('')}
function _dt(id){_t=_t.filter(t=>t.id!==id);_sv();_utl();_to('üóëÔ∏è Deleted')}

function _uss(){$('sc').textContent=_c.length;$('sp').textContent=_p.length;$('se').textContent=_e.length;$('stk').textContent=_t.length}

// Stream Breakdown
function _gsb(){const f=_cp?_e.filter(e=>e.pid===_cp.id):_e;const sb={};f.forEach(e=>{const cat=e.cat||'Mixed';if(!sb[cat])sb[cat]={tot:0,div:0,lf:0};sb[cat].tot+=e.t;if(e.dst==='d')sb[cat].div+=e.t;else sb[cat].lf+=e.t});return sb}

function _usb(){const sb=_gsb();const keys=Object.keys(sb);if(!keys.length){$('strm-empty').style.display='block';$('strm-data').style.display='none';return}$('strm-empty').style.display='none';$('strm-data').style.display='block';let gt=0,gd=0,gl=0;let html='';keys.sort((a,b)=>sb[b].tot-sb[a].tot).forEach(k=>{const s=sb[k];const rt=s.tot>0?(s.div/s.tot*100):0;const rtc=rt>=75?'':rt>=50?'med':'low';gt+=s.tot;gd+=s.div;gl+=s.lf;html+=`<tr><td>${k}</td><td class="num">${s.tot.toFixed(2)}</td><td class="num">${s.div.toFixed(2)}</td><td class="num">${s.lf.toFixed(2)}</td><td class="num rate ${rtc}">${rt.toFixed(0)}%</td></tr>`});const grt=gt>0?(gd/gt*100):0;html+=`<tr><td><strong>TOTAL</strong></td><td class="num">${gt.toFixed(2)}</td><td class="num">${gd.toFixed(2)}</td><td class="num">${gl.toFixed(2)}</td><td class="num rate">${grt.toFixed(0)}%</td></tr>`;$('strm-body').innerHTML=html;_usc(sb)}

function _usc(sb){const ctx=$('strm-chart');if(!ctx)return;if(_sch)_sch.destroy();const keys=Object.keys(sb).sort((a,b)=>sb[b].tot-sb[a].tot);const colors=keys.map(k=>_catColors[_cats.indexOf(k)]||'#6b7280');_sch=new Chart(ctx,{type:'doughnut',data:{labels:keys,datasets:[{data:keys.map(k=>sb[k].tot),backgroundColor:colors,borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#94a3b8',font:{size:10},boxWidth:12}}}}})}

function _ur(){if(!_cp){$('rnp').style.display='block';$('rc').style.display='none';return}$('rnp').style.display='none';$('rc').style.display='block';const f=_e.filter(e=>e.pid===_cp.id),tot=f.reduce((s,e)=>s+e.t,0),dv=f.filter(e=>e.dst==='d').reduce((s,e)=>s+e.t,0),lf=tot-dv,rt=tot>0?(dv/tot)*100:0;$('rt').textContent=tot.toFixed(1);$('rd').textContent=dv.toFixed(1);$('rl').textContent=lf.toFixed(1);$('rr').textContent=rt.toFixed(0)+'%';_uc(dv,lf)}

function _uc(dv,lf){const ctx=$('ch');if(!ctx)return;if(_ch)_ch.destroy();_ch=new Chart(ctx,{type:'doughnut',data:{labels:['Diverted','Landfill'],datasets:[{data:[dv||.1,lf||.1],backgroundColor:['#10b981','#ef4444'],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{color:'#94a3b8',font:{size:11}}}}}})}

// PDF Generation with Stream Breakdown
function _gp(){if(!_cp)return;const f=_e.filter(e=>e.pid===_cp.id),tot=f.reduce((s,e)=>s+e.t,0),dv=f.filter(e=>e.dst==='d').reduce((s,e)=>s+e.t,0),lf=tot-dv,rt=tot>0?(dv/tot)*100:0,pb=$('pby').value||'DiversionScan User';const sb=_gsb();const doc=new _J();

// Header
doc.setFillColor(16,185,129);doc.rect(0,0,210,40,'F');doc.setTextColor(255);doc.setFontSize(24);doc.setFont('helvetica','bold');doc.text('LEED MRc5 Compliance Report',15,18);doc.setFontSize(11);doc.text('Construction & Demolition Waste Management',15,26);doc.setFontSize(9);doc.text(`Generated: ${new Date().toLocaleDateString()} | Prepared by: ${pb}`,15,34);

// Project info bar
doc.setFillColor(240,240,240);doc.rect(0,40,210,18,'F');doc.setTextColor(60);doc.setFontSize(10);doc.text(`Project: ${_cp.n}`,15,50);if(_cp.cn)doc.text(`Customer: ${_cp.cn}`,80,50);if(_cp.ad)doc.text(`Address: ${_cp.ad}`,15,56);

// Big diversion rate
let y=68;doc.setFillColor(26,34,52);doc.roundedRect(15,y,180,32,3,3,'F');doc.setTextColor(16,185,129);doc.setFontSize(36);doc.setFont('helvetica','bold');doc.text(`${rt.toFixed(1)}%`,105,y+22,{align:'center'});doc.setFontSize(10);doc.setTextColor(200);doc.text('OVERALL DIVERSION RATE',105,y+30,{align:'center'});

// Summary boxes
y+=42;doc.setFillColor(245,245,245);doc.roundedRect(15,y,55,22,2,2,'F');doc.roundedRect(77,y,55,22,2,2,'F');doc.roundedRect(139,y,55,22,2,2,'F');doc.setFontSize(14);doc.setFont('helvetica','bold');doc.setTextColor(16,185,129);doc.text(`${tot.toFixed(2)}`,42,y+10,{align:'center'});doc.text(`${dv.toFixed(2)}`,105,y+10,{align:'center'});doc.setTextColor(239,68,68);doc.text(`${lf.toFixed(2)}`,167,y+10,{align:'center'});doc.setFontSize(8);doc.setTextColor(100);doc.text('TOTAL TONS',42,y+18,{align:'center'});doc.text('DIVERTED',105,y+18,{align:'center'});doc.text('LANDFILL',167,y+18,{align:'center'});

// LEED status
y+=30;if(_cp.lt!=='n'){const ach=rt>=parseInt(_cp.lt);doc.setFillColor(ach?16:239,ach?185:68,ach?129:68);doc.roundedRect(15,y,180,14,2,2,'F');doc.setTextColor(255);doc.setFontSize(10);doc.text(`LEED MRc5 TARGET: ${_cp.lt}% ‚Äî ${ach?'‚úì ACHIEVED':'IN PROGRESS'}`,105,y+10,{align:'center'});y+=20}

// Stream breakdown table
y+=5;doc.setTextColor(30);doc.setFontSize(12);doc.setFont('helvetica','bold');doc.text('Material Stream Breakdown',15,y);y+=6;doc.setFontSize(8);doc.setFont('helvetica','normal');doc.setTextColor(100);doc.text('Stream',20,y);doc.text('Total',80,y);doc.text('Diverted',105,y);doc.text('Landfill',135,y);doc.text('Rate',165,y);y+=2;doc.setDrawColor(200);doc.line(15,y,195,y);y+=5;doc.setTextColor(60);
const sbKeys=Object.keys(sb).sort((a,b)=>sb[b].tot-sb[a].tot);
sbKeys.forEach(k=>{const s=sb[k];const srt=s.tot>0?(s.div/s.tot*100):0;doc.text(k,20,y);doc.text(s.tot.toFixed(2),80,y);doc.text(s.div.toFixed(2),105,y);doc.text(s.lf.toFixed(2),135,y);doc.setTextColor(srt>=75?16:srt>=50?245:239,srt>=75?185:srt>=50?158:68,srt>=75?129:srt>=50?11:68);doc.text(`${srt.toFixed(0)}%`,165,y);doc.setTextColor(60);y+=5;if(y>250){doc.addPage();y=20}});
doc.setFont('helvetica','bold');doc.text('TOTAL',20,y);doc.text(tot.toFixed(2),80,y);doc.text(dv.toFixed(2),105,y);doc.text(lf.toFixed(2),135,y);doc.setTextColor(16,185,129);doc.text(`${rt.toFixed(0)}%`,165,y);

// Footer
doc.setFillColor(240,240,240);doc.rect(0,282,210,15,'F');doc.setFontSize(8);doc.setTextColor(100);doc.setFont('helvetica','normal');doc.text('Report by DiversionScan‚Ñ¢ | Powered by Dalmex Recycling, LLC | ¬© 2025 All Rights Reserved',105,289,{align:'center'});doc.text('LEED v4.1 MRc5 Compliant Waste Diversion Tracking',105,294,{align:'center'});

doc.save(`${_cp.n.replace(/[^a-z0-9]/gi,'_')}_LEED_MRc5_Report.pdf`);_to('üìÑ Report Generated!','Pu')}

// Export/Import
function _ex(){const d={v:'2.1',dt:new Date().toISOString(),c:_c,p:_p,e:_e,t:_t};const b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`DiversionScan_${new Date().toISOString().split('T')[0]}.json`;a.click();URL.revokeObjectURL(u);_to('üì§ Exported!','Pu')}
$('ii').onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const d=JSON.parse(ev.target.result);if(d.c)_c=d.c;if(d.p)_p=d.p;if(d.e)_e=d.e;if(d.t)_t=d.t;_sv();_ua();_to('üì• Imported!','Pu')}catch{_to('‚ùå Invalid','Er')}};r.readAsText(f);e.target.value=''};
$('clb').onclick=()=>{if(!_e.length)return;if(confirm('Clear all entries?')){_e=[];_sv();_ua();_to('üóëÔ∏è Cleared')}};

// Storage
function _sv(){localStorage.setItem('_c',JSON.stringify(_c));localStorage.setItem('_p',JSON.stringify(_p));localStorage.setItem('_e',JSON.stringify(_e));localStorage.setItem('_t',JSON.stringify(_t));$('ls').textContent='Just now'}
function _ld(){const c=localStorage.getItem('_c'),p=localStorage.getItem('_p'),e=localStorage.getItem('_e'),t=localStorage.getItem('_t');if(c)_c=JSON.parse(c);if(p)_p=JSON.parse(p);if(e)_e=JSON.parse(e);if(t)_t=JSON.parse(t)}
function _to(m,t=''){const el=$('to');el.textContent=m;el.className='To'+(t?' '+t:'');el.classList.add('S');setTimeout(()=>el.classList.remove('S'),2500)}

_ld();_ua();
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&(e.key==='s'||e.key==='u'||e.key==='c'))e.preventDefault()});
</script>
</body>
</html>
