<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Dalmex Fiber Hub AI</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--primary:#6366f1;--primary-dark:#4f46e5;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--ai-purple:#8b5cf6;--ai-purple-dark:#7c3aed;--dark:#1e293b;--darker:#0f172a;--card-bg:#fff;--bg:#f1f5f9;--light:#e2e8f0;--text:#1e293b;--text-muted:#64748b}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.ticker-wrap{background:linear-gradient(90deg,var(--darker),var(--dark));padding:10px 0;overflow:hidden}.ticker{display:flex;animation:tickerScroll 45s linear infinite;width:max-content}@keyframes tickerScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}.ticker-item{display:inline-flex;align-items:center;gap:8px;margin-right:50px;color:#f1f5f9;font-size:13px;white-space:nowrap}.ticker-badge{padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700;text-transform:uppercase}.ticker-badge.price{background:var(--warning);color:#000}.ticker-badge.news{background:#3b82f6}.ticker-badge.alert{background:var(--danger)}
.header{background:var(--card-bg);padding:12px 20px;border-bottom:1px solid var(--light);position:sticky;top:0;z-index:100}.header-inner{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}.header-left{display:flex;align-items:center;gap:12px}.logo{width:45px;height:45px;background:linear-gradient(135deg,var(--ai-purple),var(--ai-purple-dark));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px}.brand-title{font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--ai-purple),var(--primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.brand-sub{font-size:11px;color:var(--text-muted)}.header-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.user-badge{background:var(--light);padding:6px 12px;border-radius:8px;font-size:12px;font-weight:600}.user-badge.admin{background:linear-gradient(135deg,var(--warning),#d97706);color:#fff}.lang-toggle,.logout-btn,.admin-login-btn{padding:8px 14px;border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer}.lang-toggle{background:linear-gradient(135deg,#059669,#10b981);color:#fff}.logout-btn{background:var(--danger);color:#fff}.admin-login-btn{background:linear-gradient(135deg,var(--warning),#d97706);color:#fff}
.nav-bar{background:var(--card-bg);padding:10px 20px;border-bottom:1px solid var(--light);overflow-x:auto}.nav-inner{max-width:1400px;margin:0 auto;display:flex;gap:8px}.nav-btn{padding:10px 18px;border:none;background:var(--light);border-radius:10px;font-size:13px;font-weight:600;color:var(--text-muted);cursor:pointer;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-btn:hover{background:#e0e7ff;color:var(--primary)}.nav-btn.active{background:linear-gradient(135deg,var(--primary),var(--ai-purple));color:#fff}.nav-btn.admin-only{background:linear-gradient(135deg,var(--warning),#d97706);color:#fff}.nav-count{background:rgba(255,255,255,.3);padding:2px 8px;border-radius:6px;font-size:11px}
.main{max-width:1400px;margin:0 auto;padding:20px}
.login-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}.login-overlay.active{display:flex}.login-card{background:var(--card-bg);border-radius:24px;padding:40px;width:100%;max-width:400px}.login-logo{width:70px;height:70px;background:linear-gradient(135deg,var(--warning),#d97706);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:36px;margin:0 auto 20px}.login-title{text-align:center;font-size:24px;font-weight:800;margin-bottom:8px}.login-subtitle{text-align:center;color:var(--text-muted);margin-bottom:25px;font-size:14px}.login-error{background:#fef2f2;color:var(--danger);padding:12px;border-radius:10px;margin-bottom:15px;font-size:13px;text-align:center;display:none}.login-error.show{display:block}.form-group{margin-bottom:18px}.form-label{display:block;margin-bottom:6px;font-weight:600;font-size:13px;color:var(--text-muted)}.form-input{width:100%;padding:14px 16px;border:2px solid var(--light);border-radius:12px;font-size:15px;font-family:inherit}.form-input:focus{outline:none;border-color:var(--primary)}.login-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--warning),#d97706);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;margin-top:10px}.login-cancel{width:100%;padding:12px;background:var(--light);color:var(--text);border:none;border-radius:12px;font-size:14px;font-weight:600;cursor:pointer;margin-top:10px}
.panel-card{background:var(--card-bg);border-radius:16px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,.08);margin-bottom:20px}.panel-title{font-size:14px;font-weight:700;color:var(--text-muted);margin-bottom:15px;text-transform:uppercase;display:flex;justify-content:space-between;align-items:center}
.btn{padding:12px 20px;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px}.btn-primary{background:var(--primary);color:#fff}.btn-success{background:var(--success);color:#fff}.btn-warning{background:var(--warning);color:#fff}.btn-danger{background:var(--danger);color:#fff}.btn-outline{background:transparent;border:2px solid var(--light);color:var(--text)}.btn-sm{padding:8px 14px;font-size:12px}.btn-purple{background:linear-gradient(135deg,var(--ai-purple),var(--ai-purple-dark));color:#fff}.btn:hover{opacity:0.9;transform:translateY(-1px)}
.sort-btns{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:15px}.sort-btn{padding:6px 12px;border:2px solid var(--light);background:#fff;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer}.sort-btn.active{border-color:var(--primary);background:#e0e7ff;color:var(--primary)}
.ai-container{display:grid;grid-template-columns:1fr 350px;gap:20px}@media(max-width:1024px){.ai-container{grid-template-columns:1fr}}.chat-panel{background:var(--card-bg);border-radius:16px;overflow:hidden}.chat-header{background:linear-gradient(135deg,var(--ai-purple),var(--ai-purple-dark));color:#fff;padding:20px;display:flex;align-items:center;gap:15px}.chat-avatar{width:50px;height:50px;background:rgba(255,255,255,.2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px}.chat-title{font-size:18px;font-weight:700}.chat-status{font-size:12px;opacity:.8}.chat-messages{height:400px;overflow-y:auto;padding:20px;background:#fafbfc}.msg{display:flex;gap:12px;margin-bottom:16px}.msg.user{flex-direction:row-reverse}.msg-avatar{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}.msg.ai .msg-avatar{background:linear-gradient(135deg,var(--ai-purple),var(--ai-purple-dark))}.msg.user .msg-avatar{background:var(--primary)}.msg-content{max-width:80%;padding:14px 18px;border-radius:16px;font-size:14px;line-height:1.6;white-space:pre-wrap}.msg.ai .msg-content{background:#fff;border:1px solid var(--light)}.msg.user .msg-content{background:var(--primary);color:#fff}.chat-input-area{padding:15px 20px;background:#fff;border-top:1px solid var(--light);display:flex;gap:10px}.chat-input{flex:1;padding:14px 18px;border:2px solid var(--light);border-radius:12px;font-size:14px;font-family:inherit}.chat-input:focus{outline:none;border-color:var(--ai-purple)}
.side-panel{display:flex;flex-direction:column;gap:15px}.quick-action{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg);border-radius:10px;margin-bottom:8px;cursor:pointer;border:none;width:100%;text-align:left;font-family:inherit}.quick-action:hover{background:#e0e7ff;transform:translateX(4px)}.quick-action-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px}.quick-action-text{font-size:13px;font-weight:600}.quick-action-sub{font-size:11px;color:var(--text-muted)}.best-buyer{display:flex;align-items:center;justify-content:space-between;padding:12px;background:var(--bg);border-radius:10px;margin-bottom:8px}.best-buyer-info{display:flex;align-items:center;gap:10px}.best-buyer-rank{width:28px;height:28px;background:linear-gradient(135deg,var(--warning),#fbbf24);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff}.best-buyer-name{font-size:13px;font-weight:600}.best-buyer-type{font-size:11px;color:var(--text-muted)}.best-buyer-price{font-size:15px;font-weight:700;color:var(--success)}
.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:16px;margin-bottom:20px}.stat-card{background:var(--card-bg);border-radius:16px;padding:20px}.stat-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:12px}.stat-icon.purple{background:linear-gradient(135deg,var(--ai-purple),var(--ai-purple-dark))}.stat-icon.green{background:linear-gradient(135deg,var(--success),#059669)}.stat-icon.yellow{background:linear-gradient(135deg,var(--warning),#d97706)}.stat-icon.blue{background:linear-gradient(135deg,var(--primary),var(--primary-dark))}.stat-value{font-size:28px;font-weight:800;margin-bottom:4px}.stat-label{font-size:12px;color:var(--text-muted)}
.contacts-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;margin-bottom:20px}.search-box{display:flex;align-items:center;gap:10px;background:var(--card-bg);padding:10px 16px;border-radius:12px;flex:1;max-width:400px}.search-box input{border:none;background:none;flex:1;font-size:14px;font-family:inherit}.search-box input:focus{outline:none}.filter-btns{display:flex;gap:8px;flex-wrap:wrap}.filter-btn{padding:8px 16px;border:2px solid var(--light);background:#fff;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer}.filter-btn.active{border-color:var(--primary);background:#e0e7ff;color:var(--primary)}.contacts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px}.contact-card{background:var(--card-bg);border-radius:16px;padding:20px;border:2px solid transparent}.contact-card.priority{border-color:var(--warning)}.contact-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:12px}.contact-name{font-size:16px;font-weight:700}.contact-type{display:inline-block;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;text-transform:uppercase}.contact-type.mill{background:#dbeafe;color:#1d4ed8}.contact-type.broker{background:#fef3c7;color:#b45309}.contact-type.export{background:#d1fae5;color:#047857}.contact-person{font-size:13px;color:var(--text-muted);margin-bottom:8px}.contact-email{font-size:12px;color:var(--primary);margin-bottom:10px}.contact-commodities{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}.commodity-tag{padding:4px 10px;background:var(--light);border-radius:6px;font-size:11px;font-weight:600}.contact-prices{display:grid;grid-template-columns:repeat(auto-fit,minmax(55px,1fr));gap:8px;margin-bottom:12px;padding:12px;background:var(--bg);border-radius:10px}.price-item{text-align:center}.price-label{font-size:10px;color:var(--text-muted);text-transform:uppercase}.price-value{font-size:13px;font-weight:700;color:var(--success)}.contact-actions{display:flex;gap:8px;flex-wrap:wrap}.contact-action{padding:10px 14px;background:var(--bg);border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px}.contact-action:hover{background:var(--light)}.contact-action.call{background:#d1fae5;color:#047857}.contact-action.email{background:#dbeafe;color:#1d4ed8}.contact-action.edit{color:var(--primary)}.contact-action.delete{color:var(--danger)}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-overlay.active{display:flex}.modal{background:var(--card-bg);border-radius:20px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto}.modal-header{padding:20px 24px;border-bottom:1px solid var(--light);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--card-bg)}.modal-title{font-size:18px;font-weight:700}.modal-close{width:36px;height:36px;border-radius:10px;border:none;background:var(--light);cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center}.modal-body{padding:24px}.modal-footer{padding:16px 24px;border-top:1px solid var(--light);display:flex;justify-content:flex-end;gap:10px;position:sticky;bottom:0;background:var(--card-bg)}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}@media(max-width:500px){.form-row{grid-template-columns:1fr}}.form-select{width:100%;padding:12px 16px;border:2px solid var(--light);border-radius:10px;font-size:14px;font-family:inherit;background:#fff}.checkbox-group{display:flex;flex-wrap:wrap;gap:10px}.checkbox-item{display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--bg);border-radius:8px}.checkbox-item input{width:16px;height:16px}.checkbox-item label{font-size:13px;font-weight:500}.switch-group{display:flex;align-items:center;gap:10px}.switch{width:48px;height:26px;background:var(--light);border-radius:13px;position:relative;cursor:pointer}.switch.active{background:var(--success)}.switch::after{content:'';position:absolute;width:22px;height:22px;background:#fff;border-radius:50%;top:2px;left:2px;transition:all .2s}.switch.active::after{left:24px}.form-textarea{width:100%;padding:12px 16px;border:2px solid var(--light);border-radius:10px;font-size:14px;font-family:inherit;resize:vertical;min-height:80px}.price-input-group{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:10px}.price-input-item label{display:block;font-size:11px;font-weight:600;color:var(--text-muted);margin-bottom:4px}.price-input-item input{width:100%;padding:8px 10px;border:2px solid var(--light);border-radius:8px;font-size:13px}
.table-container{overflow-x:auto;background:var(--card-bg);border-radius:16px}.data-table{width:100%;border-collapse:collapse;font-size:13px}.data-table th{background:var(--bg);padding:14px 12px;text-align:left;font-weight:600;font-size:11px;text-transform:uppercase;color:var(--text-muted)}.data-table td{padding:12px;border-bottom:1px solid var(--light)}.data-table tr:hover{background:#f8fafc}.data-table .clickable{cursor:pointer}.data-table .clickable:hover{color:var(--primary)}
.admin-section{background:linear-gradient(135deg,#fef3c7,#fde68a);border:2px solid var(--warning);border-radius:16px;padding:20px;margin-bottom:20px}.admin-section-title{font-size:16px;font-weight:700;color:#92400e;margin-bottom:15px}.admin-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}.admin-btn{padding:14px 18px;background:#fff;border:2px solid var(--warning);border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:10px}.admin-btn:hover{background:var(--warning);color:#fff}
.activity-log{max-height:300px;overflow-y:auto}.activity-item{padding:12px;border-bottom:1px solid var(--light);font-size:13px}.activity-time{font-size:11px;color:var(--text-muted)}
.prices-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:16px}.price-card{background:var(--card-bg);border-radius:16px;padding:18px}.price-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.price-commodity{font-size:14px;font-weight:700}.price-trend{font-size:18px}.price-current{font-size:26px;font-weight:800;color:var(--success);margin-bottom:4px}.price-range{font-size:11px;color:var(--text-muted)}
.news-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}.news-card{background:var(--card-bg);border-radius:16px;overflow:hidden}.news-image{height:100px;background:linear-gradient(135deg,var(--primary),var(--ai-purple));display:flex;align-items:center;justify-content:center;font-size:32px}.news-content{padding:16px}.news-category{display:inline-block;padding:4px 10px;background:var(--light);border-radius:6px;font-size:10px;font-weight:600;text-transform:uppercase;margin-bottom:8px}.news-title{font-size:14px;font-weight:700;margin-bottom:6px}.news-excerpt{font-size:12px;color:var(--text-muted);line-height:1.5}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--dark);color:#fff;padding:14px 24px;border-radius:12px;font-size:14px;font-weight:500;z-index:2000;opacity:0;transition:all .3s}.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.footer{text-align:center;padding:30px 20px;color:var(--text-muted);font-size:12px;border-top:1px solid var(--light);margin-top:40px}
.print-section{margin-top:20px;padding-top:20px;border-top:2px dashed var(--light)}
@media print{.header,.nav-bar,.ticker-wrap,.footer,.btn,.contact-actions,.no-print{display:none!important}.main{padding:0}.contact-card,.panel-card{break-inside:avoid;box-shadow:none;border:1px solid #ccc}}
@media(max-width:768px){.header-inner{flex-direction:column}.ai-container{grid-template-columns:1fr}.chat-messages{height:300px}.dashboard-grid{grid-template-columns:repeat(2,1fr)}.contacts-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app" id="app">
<div class="ticker-wrap"><div class="ticker" id="ticker"></div></div>
<header class="header"><div class="header-inner"><div class="header-left"><div class="logo">ü§ñ</div><div><div class="brand-title">Dalmex Fiber Hub</div><div class="brand-sub">AI-Powered ‚Ä¢ Dallas, TX</div></div></div><div class="header-right"><span class="user-badge" id="userBadge">Open Access</span><button class="lang-toggle" id="langToggle" onclick="toggleLang()">üá≤üáΩ Espa√±ol</button><button class="admin-login-btn" id="adminBtn" onclick="showAdminLogin()">üëë Admin</button></div></div></header>
<nav class="nav-bar"><div class="nav-inner" id="navBar"></div></nav>
<main class="main" id="main"></main>
<footer class="footer">¬© 2025 Dalmex Recycling LLC ‚Ä¢ Created by Robert Vandling ‚Ä¢ AI-Powered by Claude</footer>
</div>
<div class="login-overlay" id="adminLogin">
<div class="login-card">
<div class="login-logo">üëë</div>
<h2 class="login-title">Admin Login</h2>
<p class="login-subtitle">RJVandling access only</p>
<div class="login-error" id="loginError"></div>
<div class="form-group"><label class="form-label">Username</label><input type="text" class="form-input" id="username" placeholder="Username"></div>
<div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="password" placeholder="Password"></div>
<button class="login-btn" onclick="handleAdminLogin()">üîê Login</button>
<button class="login-cancel" onclick="hideAdminLogin()">Cancel</button>
</div>
</div>
<div class="modal-overlay" id="contactModal">
<div class="modal">
<div class="modal-header"><h3 class="modal-title" id="modalTitle">Add Contact</h3><button class="modal-close" onclick="closeModal()">√ó</button></div>
<div class="modal-body">
<form id="contactForm">
<div class="form-row"><div class="form-group"><label class="form-label">Company *</label><input type="text" class="form-input" id="fCompany" required></div><div class="form-group"><label class="form-label">Contact</label><input type="text" class="form-input" id="fContact"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="fEmail"></div><div class="form-group"><label class="form-label">Phone</label><input type="tel" class="form-input" id="fPhone"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="fType"><option value="mill">Mill</option><option value="broker">Broker</option><option value="export">Export</option></select></div><div class="form-group"><label class="form-label">Priority</label><div class="switch-group" style="margin-top:8px"><div class="switch" id="fPrioritySwitch" onclick="toggleSwitch()"></div><span>Priority</span></div></div></div>
<div class="form-group"><label class="form-label">Commodities</label><div class="checkbox-group"><div class="checkbox-item"><input type="checkbox" name="comm" value="OCC" id="cOCC"><label for="cOCC">OCC</label></div><div class="checkbox-item"><input type="checkbox" name="comm" value="DLK" id="cDLK"><label for="cDLK">DLK</label></div><div class="checkbox-item"><input type="checkbox" name="comm" value="SWL" id="cSWL"><label for="cSWL">SWL</label></div><div class="checkbox-item"><input type="checkbox" name="comm" value="PM" id="cPM"><label for="cPM">PM</label></div><div class="checkbox-item"><input type="checkbox" name="comm" value="CBS" id="cCBS"><label for="cCBS">CBS</label></div><div class="checkbox-item"><input type="checkbox" name="comm" value="HWEC" id="cHWEC"><label for="cHWEC">HWEC</label></div><div class="checkbox-item"><input type="checkbox" name="comm" value="SOP" id="cSOP"><label for="cSOP">SOP</label></div><div class="checkbox-item"><input type="checkbox" name="comm" value="Foam" id="cFoam"><label for="cFoam">Foam</label></div></div></div>
<div class="form-group"><label class="form-label">Prices ($/ton)</label><div class="price-input-group"><div class="price-input-item"><label>OCC</label><input type="number" id="pOCC"></div><div class="price-input-item"><label>DLK</label><input type="number" id="pDLK"></div><div class="price-input-item"><label>SWL</label><input type="number" id="pSWL"></div><div class="price-input-item"><label>PM</label><input type="number" id="pPM"></div><div class="price-input-item"><label>CBS</label><input type="number" id="pCBS"></div><div class="price-input-item"><label>HWEC</label><input type="number" id="pHWEC"></div></div></div>
<div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="fNotes"></textarea></div>
</form>
</div>
<div class="modal-footer"><button class="btn btn-outline" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="saveContact()">Save</button></div>
</div>
</div>
<div class="toast" id="toast"></div>
<script>
var adminUser={username:'RJVandling',password:'Sailer66',name:'Robert Vandling',email:'rvandling@dalmex.com'};
var defaultBuyers=[{id:1,company:'Georgia Pacific',contact:'Jake Walker',email:'jacob.walker1@gapac.com',phone:'555-123-4567',type:'mill',priority:true,commodities:['OCC','DLK','PM','SWL','HWEC'],notes:'Best OCC price',prices:{OCC:65,PM:155,SWL:215,HWEC:370},prevPrices:{OCC:55,PM:150}},{id:2,company:'SKG Westrock',contact:'Cynthia Torres',email:'cynthia.torres@smurfitwestrock.com',phone:'555-234-5678',type:'mill',priority:true,commodities:['OCC','PM'],notes:'Forney TX',prices:{OCC:60},prevPrices:{}},{id:3,company:'Greenside',contact:'Casandra Espinoza',email:'grupocartonero.mty@gmail.com',phone:'555-345-6789',type:'export',priority:true,commodities:['OCC','PM','SWL'],notes:'Mexico',prices:{OCC:58,PM:165,SWL:215},prevPrices:{OCC:60,PM:165,SWL:165}},{id:4,company:'American Fiber',contact:'Steve Minor',email:'sminor@amfiberservices.com',phone:'555-456-7890',type:'broker',priority:true,commodities:['SWL','CBS','HWEC'],notes:'Multiple grades',prices:{SWL:215,CBS:160,HWEC:250},prevPrices:{CBS:210}},{id:5,company:'Marck',contact:'Don Langley',email:'dlongley@marck.net',phone:'555-567-8901',type:'broker',priority:false,commodities:['OCC','SWL'],notes:'Best SWL at $230',prices:{OCC:55,SWL:230},prevPrices:{}},{id:6,company:'Pratt Industries',contact:'',email:'',phone:'',type:'mill',priority:false,commodities:['OCC'],notes:'Need contact',prices:{},prevPrices:{}},{id:7,company:'Future Foam',contact:'Tina Aaron',email:'tmaaron@futurefoam.com',phone:'555-678-9012',type:'mill',priority:false,commodities:['Foam'],notes:'Foam only',prices:{},prevPrices:{}}];
var tickerItems=[{type:'price',text:'OCC: $55-65/ton (Dec 2025)'},{type:'price',text:'SWL: $215-230/ton'},{type:'price',text:'PM: $155-165/ton'},{type:'news',text:'Georgia Pacific top OCC at $65'},{type:'alert',text:'Next PPI: Jan 14, 2026'},{type:'price',text:'HWEC: $250-370/ton'}];
var newsItems=[{icon:'üì∞',category:'Market',title:'OCC Prices Stabilize',excerpt:'Markets stable heading into 2026.',date:'Dec 28'},{icon:'üè≠',category:'Industry',title:'GP Leads DFW',excerpt:'Georgia Pacific at $65/ton.',date:'Dec 26'},{icon:'üìä',category:'PPI',title:'Next PPI Jan 14',excerpt:'BLS report due mid-January.',date:'Dec 20'}];
var marketPrices={OCC:{low:55,high:65,prev:60},SWL:{low:215,high:230,prev:165},PM:{low:155,high:165,prev:150},CBS:{low:155,high:165,prev:210},HWEC:{low:250,high:370,prev:null}};
var lang='en',isAdmin=false,currentTab='ai',buyers=[],activityLog=[],chat=[],searchTerm='',filterType='all',sortBy='name',editId=null;
function loadData(){var b=localStorage.getItem('fh_buyers2');buyers=b?JSON.parse(b):JSON.parse(JSON.stringify(defaultBuyers));var a=localStorage.getItem('fh_activity');activityLog=a?JSON.parse(a):[];}
function saveData(){localStorage.setItem('fh_buyers2',JSON.stringify(buyers));localStorage.setItem('fh_activity',JSON.stringify(activityLog));}
function logActivity(action){var entry={time:new Date().toLocaleString(),action:action,user:isAdmin?'Admin':'Guest'};activityLog.unshift(entry);if(activityLog.length>50)activityLog.pop();saveData();}
function toast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show')},3000);}
function toggleLang(){lang=lang==='en'?'es':'en';document.getElementById('langToggle').innerHTML=lang==='en'?'üá≤üáΩ Espa√±ol':'üá∫üá∏ English';render();}
function showAdminLogin(){document.getElementById('adminLogin').classList.add('active');}
function hideAdminLogin(){document.getElementById('adminLogin').classList.remove('active');document.getElementById('loginError').classList.remove('show');}
function handleAdminLogin(){var u=document.getElementById('username').value.trim(),p=document.getElementById('password').value;if(u.toLowerCase()===adminUser.username.toLowerCase()&&p===adminUser.password){isAdmin=true;hideAdminLogin();document.getElementById('userBadge').textContent='üëë '+adminUser.name;document.getElementById('userBadge').classList.add('admin');document.getElementById('adminBtn').style.display='none';logActivity('Admin logged in');notifyAdminLogin();renderNav();render();toast('Welcome Admin!');}else{document.getElementById('loginError').textContent='Invalid credentials';document.getElementById('loginError').classList.add('show');}}
function notifyAdminLogin(){var su=encodeURIComponent('Fiber Hub: Admin Login Alert'),bo=encodeURIComponent('Admin login at '+new Date().toLocaleString()+'\n\nUser: '+adminUser.name);window.open('mailto:'+adminUser.email+'?subject='+su+'&body='+bo,'_blank');}
function logoutAdmin(){isAdmin=false;document.getElementById('userBadge').textContent='Open Access';document.getElementById('userBadge').classList.remove('admin');document.getElementById('adminBtn').style.display='inline-block';logActivity('Admin logged out');renderNav();render();toast('Logged out');}
function initTicker(){var tk=document.getElementById('ticker'),it=tickerItems.map(function(i){return '<div class="ticker-item"><span class="ticker-badge '+i.type+'">'+i.type.toUpperCase()+'</span> '+i.text+'</div>';}).join('');tk.innerHTML=it+it;}
function renderNav(){var tabs=[{id:'ai',icon:'ü§ñ',label:'AI'},{id:'dashboard',icon:'üìä',label:'Dashboard'},{id:'contacts',icon:'üë•',label:'Contacts',count:buyers.length},{id:'prices',icon:'üí∞',label:'Prices'},{id:'news',icon:'üì∞',label:'News'}];if(isAdmin)tabs.push({id:'admin',icon:'‚öôÔ∏è',label:'Admin',adminOnly:true});document.getElementById('navBar').innerHTML=tabs.map(function(t){return '<button class="nav-btn '+(currentTab===t.id?'active':'')+' '+(t.adminOnly?'admin-only':'')+'" onclick="setTab(\''+t.id+'\')">'+t.icon+' '+t.label+(t.count!==undefined?' <span class="nav-count">'+t.count+'</span>':'')+'</button>';}).join('');}
function setTab(t){currentTab=t;renderNav();render();}
function render(){var m=document.getElementById('main');if(currentTab==='ai')m.innerHTML=renderAI();else if(currentTab==='dashboard')m.innerHTML=renderDashboard();else if(currentTab==='contacts')m.innerHTML=renderContacts();else if(currentTab==='prices')m.innerHTML=renderPrices();else if(currentTab==='news')m.innerHTML=renderNews();else if(currentTab==='admin')m.innerHTML=renderAdmin();}
function renderAI(){var best=buyers.filter(function(b){return b.prices&&b.prices.OCC;}).sort(function(a,b){return b.prices.OCC-a.prices.OCC;}).slice(0,3);return '<div class="ai-container"><div class="chat-panel"><div class="chat-header"><div class="chat-avatar">ü§ñ</div><div><div class="chat-title">Fiber Hub AI</div><div class="chat-status">Powered by Claude</div></div></div><div class="chat-messages" id="chatBox">'+chat.map(function(m){return '<div class="msg '+m.role+'"><div class="msg-avatar">'+(m.role==='ai'?'ü§ñ':'üë§')+'</div><div class="msg-content">'+m.content+'</div></div>';}).join('')+'</div><div class="chat-input-area"><input type="text" class="chat-input" id="chatInput" placeholder="Ask about prices, buyers..." onkeypress="if(event.key===\'Enter\')sendChat()"><button class="btn btn-purple" onclick="sendChat()">Send</button></div></div><div class="side-panel"><div class="panel-card"><div class="panel-title">Quick Actions</div><button class="quick-action" onclick="askAI(\'Best OCC?\')"><div class="quick-action-icon" style="background:#fef3c7">üì¶</div><div><div class="quick-action-text">Best OCC</div><div class="quick-action-sub">Top buyers</div></div></button><button class="quick-action" onclick="askAI(\'Best SWL?\')"><div class="quick-action-icon" style="background:#dbeafe">üìÑ</div><div><div class="quick-action-text">Best SWL</div><div class="quick-action-sub">White ledger</div></div></button><button class="quick-action" onclick="printPrices()"><div class="quick-action-icon" style="background:#d1fae5">üñ®Ô∏è</div><div><div class="quick-action-text">Print Prices</div><div class="quick-action-sub">PDF sheet</div></div></button><button class="quick-action" onclick="printContacts()"><div class="quick-action-icon" style="background:#fce7f3">üìã</div><div><div class="quick-action-text">Print Contacts</div><div class="quick-action-sub">Contact list</div></div></button></div><div class="panel-card"><div class="panel-title">Top OCC</div>'+best.map(function(b,i){return '<div class="best-buyer"><div class="best-buyer-info"><div class="best-buyer-rank">'+(i+1)+'</div><div><div class="best-buyer-name">'+b.company+'</div><div class="best-buyer-type">'+b.type+'</div></div></div><div class="best-buyer-price">$'+b.prices.OCC+'</div></div>';}).join('')+'</div></div></div>';}
function getSortedBuyers(){var sorted=buyers.slice();if(sortBy==='occ')sorted.sort(function(a,b){return(b.prices&&b.prices.OCC||0)-(a.prices&&a.prices.OCC||0);});else if(sortBy==='swl')sorted.sort(function(a,b){return(b.prices&&b.prices.SWL||0)-(a.prices&&a.prices.SWL||0);});else if(sortBy==='pm')sorted.sort(function(a,b){return(b.prices&&b.prices.PM||0)-(a.prices&&a.prices.PM||0);});else sorted.sort(function(a,b){return a.company.localeCompare(b.company);});return sorted;}
function renderDashboard(){var mi=buyers.filter(function(b){return b.type==='mill';}).length,pr=buyers.filter(function(b){return b.priority;}).length,we=buyers.filter(function(b){return b.email;}).length,op=buyers.filter(function(b){return b.prices&&b.prices.OCC;}).map(function(b){return b.prices.OCC;}),av=op.length?Math.round(op.reduce(function(a,b){return a+b;},0)/op.length):0;var sorted=getSortedBuyers().filter(function(b){return b.prices&&Object.keys(b.prices).length;});return '<div class="dashboard-grid"><div class="stat-card"><div class="stat-icon purple">üë•</div><div class="stat-value">'+buyers.length+'</div><div class="stat-label">Total</div></div><div class="stat-card"><div class="stat-icon yellow">‚≠ê</div><div class="stat-value">'+pr+'</div><div class="stat-label">Priority</div></div><div class="stat-card"><div class="stat-icon green">üí∞</div><div class="stat-value">$'+av+'</div><div class="stat-label">Avg OCC</div></div><div class="stat-card"><div class="stat-icon blue">üè≠</div><div class="stat-value">'+mi+'</div><div class="stat-label">Mills</div></div></div><div class="panel-card"><div class="panel-title"><span>Price Comparison</span><div class="no-print"><button class="btn btn-sm btn-outline" onclick="printPrices()">üñ®Ô∏è Print</button></div></div><div class="sort-btns no-print"><button class="sort-btn '+(sortBy==='name'?'active':'')+'" onclick="sortBy=\'name\';render()">A-Z</button><button class="sort-btn '+(sortBy==='occ'?'active':'')+'" onclick="sortBy=\'occ\';render()">OCC ‚Üì</button><button class="sort-btn '+(sortBy==='swl'?'active':'')+'" onclick="sortBy=\'swl\';render()">SWL ‚Üì</button><button class="sort-btn '+(sortBy==='pm'?'active':'')+'" onclick="sortBy=\'pm\';render()">PM ‚Üì</button></div><div class="table-container"><table class="data-table"><thead><tr><th>Buyer</th><th>Type</th><th>OCC</th><th>SWL</th><th>PM</th><th>HWEC</th><th class="no-print">Actions</th></tr></thead><tbody>'+sorted.map(function(b){return '<tr><td><strong>'+b.company+'</strong><br><span style="font-size:11px;color:var(--text-muted)">'+(b.contact||'')+'</span></td><td><span class="contact-type '+b.type+'">'+b.type+'</span></td><td style="color:var(--success);font-weight:700">'+(b.prices.OCC?'$'+b.prices.OCC:'-')+'</td><td style="color:var(--success);font-weight:700">'+(b.prices.SWL?'$'+b.prices.SWL:'-')+'</td><td style="color:var(--success);font-weight:700">'+(b.prices.PM?'$'+b.prices.PM:'-')+'</td><td style="color:var(--success);font-weight:700">'+(b.prices.HWEC?'$'+b.prices.HWEC:'-')+'</td><td class="no-print">'+(b.phone?'<button class="btn btn-sm btn-success" onclick="callBuyer(\''+b.phone+'\')">üìû</button> ':'')+(b.email?'<button class="btn btn-sm btn-primary" onclick="emailBuyer('+b.id+')">‚úâÔ∏è</button>':'')+'</td></tr>';}).join('')+'</tbody></table></div></div>';}
function renderContacts(){var f=getSortedBuyers();if(searchTerm){var s=searchTerm.toLowerCase();f=f.filter(function(b){return b.company.toLowerCase().indexOf(s)>-1||(b.contact&&b.contact.toLowerCase().indexOf(s)>-1);});}if(filterType!=='all')f=f.filter(function(b){return b.type===filterType;});return '<div class="contacts-header"><div class="search-box"><span>üîç</span><input type="text" placeholder="Search..." value="'+searchTerm+'" oninput="searchTerm=this.value;render()"></div><div class="filter-btns"><button class="filter-btn '+(filterType==='all'?'active':'')+'" onclick="filterType=\'all\';render()">All</button><button class="filter-btn '+(filterType==='mill'?'active':'')+'" onclick="filterType=\'mill\';render()">Mills</button><button class="filter-btn '+(filterType==='broker'?'active':'')+'" onclick="filterType=\'broker\';render()">Brokers</button><button class="filter-btn '+(filterType==='export'?'active':'')+'" onclick="filterType=\'export\';render()">Export</button></div>'+(isAdmin?'<button class="btn btn-primary" onclick="openModal()">‚ûï Add</button>':'')+'</div><div class="sort-btns"><button class="sort-btn '+(sortBy==='name'?'active':'')+'" onclick="sortBy=\'name\';render()">A-Z</button><button class="sort-btn '+(sortBy==='occ'?'active':'')+'" onclick="sortBy=\'occ\';render()">OCC ‚Üì</button><button class="sort-btn '+(sortBy==='swl'?'active':'')+'" onclick="sortBy=\'swl\';render()">SWL ‚Üì</button></div><div class="contacts-grid">'+f.map(function(b){return '<div class="contact-card '+(b.priority?'priority':'')+'"><div class="contact-header"><div><div class="contact-name">'+b.company+'</div>'+(b.priority?'<span style="color:var(--warning);font-size:12px">‚≠ê</span>':'')+'</div><span class="contact-type '+b.type+'">'+b.type+'</span></div><div class="contact-person">üë§ '+(b.contact||'No contact')+'</div>'+(b.email?'<div class="contact-email">‚úâÔ∏è '+b.email+'</div>':'')+(b.phone?'<div style="font-size:12px;color:var(--text-muted);margin-bottom:10px">üìû '+b.phone+'</div>':'')+'<div class="contact-commodities">'+(b.commodities||[]).map(function(c){return '<span class="commodity-tag">'+c+'</span>';}).join('')+'</div>'+(b.prices&&Object.keys(b.prices).length?'<div class="contact-prices">'+Object.keys(b.prices).filter(function(k){return b.prices[k];}).map(function(k){return '<div class="price-item"><div class="price-label">'+k+'</div><div class="price-value">$'+b.prices[k]+'</div></div>';}).join('')+'</div>':'')+'<div class="contact-actions">'+(b.phone?'<button class="contact-action call" onclick="callBuyer(\''+b.phone+'\')">üìû Call</button>':'')+(b.email?'<button class="contact-action email" onclick="emailBuyer('+b.id+')">‚úâÔ∏è Email</button>':'')+(isAdmin?'<button class="contact-action edit" onclick="editContact('+b.id+')">‚úèÔ∏è</button><button class="contact-action delete" onclick="deleteContact('+b.id+')">üóëÔ∏è</button>':'')+'</div></div>';}).join('')+'</div><div class="print-section no-print"><button class="btn btn-outline" onclick="printContacts()">üñ®Ô∏è Print Contact List</button></div>';}
function renderPrices(){var cs=[{n:'OCC',d:marketPrices.OCC},{n:'SWL',d:marketPrices.SWL},{n:'PM',d:marketPrices.PM},{n:'CBS',d:marketPrices.CBS},{n:'HWEC',d:marketPrices.HWEC}];return '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px"><div><h2 style="font-size:20px;font-weight:700">Market Prices - Dec 2025</h2><p style="color:var(--text-muted);font-size:13px">Next PPI: Jan 14, 2026</p></div><button class="btn btn-outline no-print" onclick="printPrices()">üñ®Ô∏è Print Price Sheet</button></div><div class="prices-grid">'+cs.map(function(c){var ch=c.d.prev?(c.d.high-c.d.prev):null,tr=ch>0?'üìà':ch<0?'üìâ':'‚û°Ô∏è';return '<div class="price-card"><div class="price-card-header"><div class="price-commodity">'+c.n+'</div><div class="price-trend">'+tr+'</div></div><div class="price-current">$'+(c.d.low===c.d.high?c.d.high:c.d.low+'-'+c.d.high)+'</div><div class="price-range">per ton | DFW Market</div>'+(ch!==null?'<div style="color:'+(ch>0?'var(--success)':'var(--danger)')+';font-size:12px;font-weight:600;margin-top:4px">'+(ch>0?'‚Üë +':'‚Üì ')+ch+' vs Nov</div>':'')+'</div>';}).join('')+'</div><div class="panel-card" style="margin-top:20px"><div class="panel-title">Buyer Price Comparison</div><div class="sort-btns"><button class="sort-btn '+(sortBy==='occ'?'active':'')+'" onclick="sortBy=\'occ\';render()">OCC ‚Üì</button><button class="sort-btn '+(sortBy==='swl'?'active':'')+'" onclick="sortBy=\'swl\';render()">SWL ‚Üì</button><button class="sort-btn '+(sortBy==='pm'?'active':'')+'" onclick="sortBy=\'pm\';render()">PM ‚Üì</button></div><div class="table-container"><table class="data-table"><thead><tr><th>Buyer</th><th>OCC</th><th>SWL</th><th>PM</th><th>CBS</th><th>HWEC</th></tr></thead><tbody>'+getSortedBuyers().filter(function(b){return b.prices&&Object.keys(b.prices).length;}).map(function(b){return '<tr><td><strong>'+b.company+'</strong></td><td style="color:var(--success);font-weight:700">'+(b.prices.OCC?'$'+b.prices.OCC:'-')+'</td><td style="color:var(--success);font-weight:700">'+(b.prices.SWL?'$'+b.prices.SWL:'-')+'</td><td style="color:var(--success);font-weight:700">'+(b.prices.PM?'$'+b.prices.PM:'-')+'</td><td style="color:var(--success);font-weight:700">'+(b.prices.CBS?'$'+b.prices.CBS:'-')+'</td><td style="color:var(--success);font-weight:700">'+(b.prices.HWEC?'$'+b.prices.HWEC:'-')+'</td></tr>';}).join('')+'</tbody></table></div></div><div class="panel-card" style="margin-top:20px"><div class="panel-title">BLS PPI Codes</div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;font-size:12px"><div style="padding:10px;background:var(--bg);border-radius:8px"><strong>WPU0912</strong> - Recyclable Paper</div><div style="padding:10px;background:var(--bg);border-radius:8px"><strong>WPU09120325</strong> - OCC</div></div><div style="margin-top:15px" class="no-print"><a href="https://fred.stlouisfed.org/series/WPU09120325" target="_blank" class="btn btn-outline">üìä FRED</a> <a href="https://www.bls.gov/ppi/" target="_blank" class="btn btn-outline">üîó BLS</a></div></div>';}
function renderNews(){return '<div style="margin-bottom:20px"><h2 style="font-size:20px;font-weight:700">Industry News</h2></div><div class="news-grid">'+newsItems.map(function(n){return '<div class="news-card"><div class="news-image">'+n.icon+'</div><div class="news-content"><span class="news-category">'+n.category+'</span><h3 class="news-title">'+n.title+'</h3><p class="news-excerpt">'+n.excerpt+'</p></div></div>';}).join('')+'</div>';}
function renderAdmin(){if(!isAdmin)return '<p>Access denied</p>';return '<div class="admin-section"><div class="admin-section-title">üëë Admin Panel - RJVandling</div><div class="admin-grid"><button class="admin-btn" onclick="openModal()">‚ûï Add Contact</button><button class="admin-btn" onclick="bccEmailAll()">üìß BCC Email Blast</button><button class="admin-btn" onclick="exportCSV()">üì• Export CSV</button><button class="admin-btn" onclick="logoutAdmin()">üö™ Logout Admin</button></div></div><div class="panel-card"><div class="panel-title">üìß BCC Email Blast</div><p style="font-size:13px;color:var(--text-muted);margin-bottom:15px">Send to all buyers - they won\'t see each other\'s emails</p><button class="btn btn-primary" onclick="bccEmailAll()">Send BCC Email to '+buyers.filter(function(b){return b.email;}).length+' Buyers</button></div><div class="panel-card"><div class="panel-title">üìã Activity Log</div><div class="activity-log">'+(activityLog.length?activityLog.slice(0,20).map(function(a){return '<div class="activity-item"><strong>'+a.action+'</strong><br><span class="activity-time">'+a.time+' ‚Ä¢ '+a.user+'</span></div>';}).join(''):'<p style="color:var(--text-muted)">No activity yet</p>')+'</div></div><div class="panel-card"><div class="panel-title">‚öôÔ∏è Data Management</div><div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn btn-outline" onclick="exportCSV()">üì• Export CSV</button><button class="btn btn-danger" onclick="resetData()">üîÑ Reset Data</button></div></div>';}
function callBuyer(phone){window.location.href='tel:'+phone.replace(/[^0-9]/g,'');logActivity('Called: '+phone);}
function emailBuyer(id){var b=buyers.find(function(x){return x.id===id;});if(!b||!b.email){toast('No email');return;}var cm=(b.commodities||['OCC','PM','SWL']).map(function(c){return '‚Ä¢ '+c;}).join('\n'),su=encodeURIComponent('Price Request - Dalmex - Jan 2026'),bo=encodeURIComponent('Dear '+(b.contact||'Team')+',\n\nRequesting pricing for:\n\n'+cm+'\n\nVolumes:\n- OCC: 200-300 tons\n- PM: 50-100 tons\n- SWL: 20-50 tons\n\nThanks,\nDalmex Recycling\n214-352-2000');window.location.href='mailto:'+b.email+'?subject='+su+'&body='+bo;logActivity('Emailed: '+b.company);}
function bccEmailAll(){var emails=buyers.filter(function(b){return b.email;}).map(function(b){return b.email;});if(!emails.length){toast('No emails');return;}var su=encodeURIComponent('Price Request - Dalmex Recycling - January 2026'),bo=encodeURIComponent('Dear Partner,\n\nRequesting your current pricing for recovered paper grades:\n\n‚Ä¢ OCC (PS 11)\n‚Ä¢ Sorted White Ledger (SWL)\n‚Ä¢ Mixed Paper (PM)\n‚Ä¢ CBS/Coated Book Stock\n‚Ä¢ HWEC\n\nOur monthly volumes:\n- OCC: 200-300 tons\n- PM: 50-100 tons\n- SWL: 20-50 tons\n\nPlease reply with your current rates.\n\nBest regards,\nRobert Vandling\nDalmex Recycling LLC\n2828 Nagle St, Dallas, TX 75220\n214-352-2000');window.location.href='mailto:?bcc='+emails.join(',')+'&subject='+su+'&body='+bo;logActivity('BCC email blast to '+emails.length+' buyers');toast('Opening email with BCC');}
function printPrices(){currentTab='prices';render();setTimeout(function(){window.print();},300);}
function printContacts(){currentTab='contacts';render();setTimeout(function(){window.print();},300);}
function exportCSV(){var hd=['Company','Contact','Email','Phone','Type','Priority','Commodities','OCC','SWL','PM','CBS','HWEC','Notes'],rw=buyers.map(function(b){return[b.company,b.contact||'',b.email||'',b.phone||'',b.type,b.priority?'Yes':'No',(b.commodities||[]).join('; '),b.prices&&b.prices.OCC?b.prices.OCC:'',b.prices&&b.prices.SWL?b.prices.SWL:'',b.prices&&b.prices.PM?b.prices.PM:'',b.prices&&b.prices.CBS?b.prices.CBS:'',b.prices&&b.prices.HWEC?b.prices.HWEC:'',(b.notes||'').replace(/,/g,';')];});var csv=[hd.join(',')].concat(rw.map(function(r){return r.map(function(c){return '"'+c+'"';}).join(',');})).join('\n'),bl=new Blob([csv],{type:'text/csv'}),ur=URL.createObjectURL(bl),a=document.createElement('a');a.href=ur;a.download='dalmex_'+new Date().toISOString().split('T')[0]+'.csv';a.click();URL.revokeObjectURL(ur);logActivity('Exported CSV');toast('Downloaded');}
function addWelcome(){chat.push({role:'ai',content:'üëã Welcome to Fiber Hub!\n\nI can help with:\n‚Ä¢ "Best OCC?" - Top buyers\n‚Ä¢ "Best SWL?" - White ledger\n‚Ä¢ "Prices" - Market rates\n\nüñ®Ô∏è Use Print buttons for PDF sheets!'});}
function sendChat(){var inp=document.getElementById('chatInput'),msg=inp.value.trim();if(!msg)return;chat.push({role:'user',content:msg});inp.value='';setTimeout(function(){chat.push({role:'ai',content:processAI(msg)});render();var bx=document.getElementById('chatBox');if(bx)bx.scrollTop=bx.scrollHeight;},500);render();}
function askAI(q){document.getElementById('chatInput').value=q;sendChat();}
function processAI(q){var ql=q.toLowerCase();if(ql.indexOf('occ')>-1&&(ql.indexOf('best')>-1||ql.indexOf('who')>-1||ql.indexOf('top')>-1)){var best=buyers.filter(function(b){return b.prices&&b.prices.OCC;}).sort(function(a,b){return b.prices.OCC-a.prices.OCC;}).slice(0,5);return 'üì¶ Best OCC (Dec 2025):\n\n'+best.map(function(b,i){return(i+1)+'. '+b.company+' - $'+b.prices.OCC+'/ton\n   üìû '+(b.phone||'No phone');}).join('\n\n')+'\n\nüí° GP pays top at $65!';}if(ql.indexOf('swl')>-1||ql.indexOf('white')>-1){var best=buyers.filter(function(b){return b.prices&&b.prices.SWL;}).sort(function(a,b){return b.prices.SWL-a.prices.SWL;}).slice(0,5);return 'üìÑ Best SWL:\n\n'+best.map(function(b,i){return(i+1)+'. '+b.company+' - $'+b.prices.SWL;}).join('\n')+'\n\nüí° Marck pays $230!';}if(ql.indexOf('price')>-1||ql.indexOf('market')>-1){return 'üìä Dec 2025 Prices:\n\n‚Ä¢ OCC: $55-65/ton\n‚Ä¢ SWL: $215-230/ton\n‚Ä¢ PM: $155-165/ton\n‚Ä¢ CBS: $155-165/ton\n‚Ä¢ HWEC: $250-370/ton\n\nüìÖ Next PPI: Jan 14, 2026\n\nüñ®Ô∏è Click "Print Prices" for PDF!';}if(ql.indexOf('print')>-1){return 'üñ®Ô∏è Print Options:\n\n1. Dashboard ‚Üí Print Price Sheet\n2. Contacts ‚Üí Print Contact List\n3. Prices ‚Üí Print Full Report\n\nJust click the üñ®Ô∏è button!';}return 'ü§ñ Try asking:\n\n‚Ä¢ "Best OCC price?"\n‚Ä¢ "Best SWL?"\n‚Ä¢ "Current prices"\n‚Ä¢ "Print options"';}
function openModal(id){if(!isAdmin){toast('Admin only');return;}editId=id||null;var md=document.getElementById('contactModal');document.getElementById('modalTitle').textContent=id?'Edit Contact':'Add Contact';if(id){var b=buyers.find(function(x){return x.id===id;});if(b){document.getElementById('fCompany').value=b.company||'';document.getElementById('fContact').value=b.contact||'';document.getElementById('fEmail').value=b.email||'';document.getElementById('fPhone').value=b.phone||'';document.getElementById('fType').value=b.type||'mill';document.getElementById('fNotes').value=b.notes||'';var sw=document.getElementById('fPrioritySwitch');if(b.priority)sw.classList.add('active');else sw.classList.remove('active');document.querySelectorAll('input[name="comm"]').forEach(function(cb){cb.checked=(b.commodities||[]).indexOf(cb.value)>-1;});['OCC','DLK','SWL','PM','CBS','HWEC'].forEach(function(c){var inp=document.getElementById('p'+c);if(inp)inp.value=b.prices&&b.prices[c]?b.prices[c]:'';});}}else{document.getElementById('contactForm').reset();document.getElementById('fPrioritySwitch').classList.remove('active');}md.classList.add('active');}
function closeModal(){document.getElementById('contactModal').classList.remove('active');editId=null;}
function toggleSwitch(){document.getElementById('fPrioritySwitch').classList.toggle('active');}
function saveContact(){var cm=[];document.querySelectorAll('input[name="comm"]:checked').forEach(function(cb){cm.push(cb.value);});var pr={};['OCC','DLK','SWL','PM','CBS','HWEC'].forEach(function(c){var inp=document.getElementById('p'+c);if(inp&&inp.value)pr[c]=parseInt(inp.value);});var d={company:document.getElementById('fCompany').value,contact:document.getElementById('fContact').value,email:document.getElementById('fEmail').value,phone:document.getElementById('fPhone').value,type:document.getElementById('fType').value,priority:document.getElementById('fPrioritySwitch').classList.contains('active'),commodities:cm,notes:document.getElementById('fNotes').value,prices:pr,prevPrices:{}};if(!d.company){toast('Company required');return;}if(editId){var ix=buyers.findIndex(function(b){return b.id===editId;});if(ix>-1){d.prevPrices=buyers[ix].prevPrices||{};buyers[ix]=Object.assign({},buyers[ix],d);}logActivity('Edited: '+d.company);toast('Updated');}else{d.id=buyers.length?Math.max.apply(null,buyers.map(function(b){return b.id;}))+1:1;buyers.push(d);logActivity('Added: '+d.company);toast('Added');}saveData();closeModal();renderNav();render();}
function editContact(id){openModal(id);}
function deleteContact(id){if(!isAdmin){toast('Admin only');return;}var b=buyers.find(function(x){return x.id===id;});if(confirm('Delete '+b.company+'?')){buyers=buyers.filter(function(x){return x.id!==id;});saveData();logActivity('Deleted: '+b.company);renderNav();render();toast('Deleted');}}
function resetData(){if(confirm('Reset all data?')){localStorage.removeItem('fh_buyers2');localStorage.removeItem('fh_activity');loadData();logActivity('Data reset');renderNav();render();toast('Reset');}}
loadData();initTicker();renderNav();render();addWelcome();
</script>
</body>
</html>
